<!-- 
  ========================================
  ðŸš¨ CODE REVIEWER: READ THIS FIRST!
  ========================================
  
  This is a DEVELOPMENT file, not production code!
  
  BEFORE reviewing this file:
  1. Read frontend/README.md for project overview
  2. Read frontend/ARCHITECTURE.md for architecture decisions
  3. Read frontend/CODE_REVIEW_GUIDE.md for review strategy
  4. Check frontend/dist/ for production code
  
  This file is intentionally large (4,891 lines) for rapid development.
  Production code is clean and organized in dist/ directory.
  
  Architecture: Development â†’ Build â†’ Production
  ========================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEX BENEFITS - Consumer Portal</title>
    <style>
        /* ========================================
           WEX BENEFITS PORTAL - CSS ORGANIZATION
           ========================================
           
           This CSS is organized into clear sections:
           1. RESET & BASE STYLES (lines ~10-20)
           2. NAVIGATION & HEADER (lines ~25-100)
           3. ALERTS & NOTIFICATIONS (lines ~105-160)
           4. MAIN CONTENT & LAYOUT (lines ~165-250)
           5. ACTION BUTTONS & INTERACTIVE (lines ~255-300)
           6. TABLES & DATA DISPLAY (lines ~305-400)
           7. WORKFLOW MODAL SYSTEM (lines ~405-500)
           8. RESPONSIVE DESIGN (lines ~505-520)
           
           IMPORTANT: Workflow modals are completely separate from portal elements
           to prevent CSS conflicts and visibility issues.
           ======================================== */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #2d3748;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
        }

        /* Navigation Styles */
        .main-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            padding: 0;
            margin-bottom: 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            color: #253746;
            margin: 0;
            font-weight: 700;
            background: linear-gradient(135deg, #253746 0%, #C8102E 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-center {
            display: flex;
            gap: 30px;
        }

        .nav-link {
            text-decoration: none;
            color: #4a5568;
            padding: 10px 0;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
        }

        .nav-link:hover {
            color: #253746;
            transform: translateY(-1px);
        }

        .nav-link.active {
            border-bottom-color: #C8102E;
            color: #253746;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-badge {
            background: linear-gradient(135deg, #C8102E 0%, #e53e3e 100%);
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 0.75rem;
            margin-left: 5px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(200, 16, 46, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .user-menu:hover {
            background-color: #f7fafc;
        }

        .cart-icon {
            position: relative;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .cart-icon:hover {
            background-color: #f7fafc;
        }

        .logout-link {
            color: #4a5568;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .logout-link:hover {
            background-color: #f7fafc;
        }

        /* Alert Styles */
        .alerts-section {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .alert {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            gap: 15px;
        }

        .alert-warning {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #e53e3e;
        }

        .alert-info {
            background: #bee3f8;
            color: #2a4365;
            border-left: 4px solid #3182ce;
        }

        .alert-text {
            flex: 1;
        }

        .alert-link {
            color: #3182ce;
            text-decoration: none;
            font-weight: 500;
        }

        .alert-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #742a2a;
        }

        /* Main Content & Layout */
        .main-content {
            padding: 30px;
            display: block;
            visibility: visible;
        }

        /* Hero Section - New prominent home screen section */
        .hero-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .hero-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(37, 55, 70, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(200, 16, 46, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(37, 55, 70, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #253746 0%, #C8102E 100%);
            opacity: 0.8;
        }

        .hero-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 40px;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #253746;
            margin-bottom: 20px;
            line-height: 1.2;
            background: linear-gradient(135deg, #253746 0%, #C8102E 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: #4a5568;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .hero-features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .hero-feature {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: linear-gradient(135deg, rgba(37, 55, 70, 0.05) 0%, rgba(200, 16, 46, 0.05) 100%);
            border-radius: 12px;
            border: 1px solid rgba(37, 55, 70, 0.1);
            transition: all 0.3s ease;
        }

        .hero-feature:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(37, 55, 70, 0.15);
            border-color: rgba(37, 55, 70, 0.2);
        }

        .feature-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .hero-action {
            text-align: center;
        }

        .hero-cta-button {
            background: linear-gradient(135deg, #C8102E 0%, #a30d25 100%);
            color: white;
            border: none;
            padding: 20px 32px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 8px 24px rgba(200, 16, 46, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            animation: subtle-pulse 3s ease-in-out infinite;
        }

        .hero-cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .hero-cta-button:hover::before {
            left: 100%;
        }

        .hero-cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(200, 16, 46, 0.4);
            background: linear-gradient(135deg, #a30d25 0%, #C8102E 100%);
        }

        .hero-cta-button:active {
            transform: translateY(-1px);
        }

        .cta-icon {
            font-size: 1.4rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .cta-text {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .cta-arrow {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .hero-cta-button:hover .cta-arrow {
            transform: translateX(4px);
        }

        .hero-cta-subtitle {
            color: #718096;
            font-size: 0.95rem;
            font-style: italic;
        }

        .hero-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .hero-illustration {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .floating-card {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            animation: float 6s ease-in-out infinite;
        }

        .floating-card:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        }

        .card-1 {
            top: 20px;
            left: 20px;
            animation-delay: 0s;
        }

        .card-2 {
            top: 80px;
            right: 20px;
            animation-delay: 2s;
        }

        .card-3 {
            bottom: 20px;
            left: 50px;
            animation-delay: 4s;
        }

        .card-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .card-text {
            font-size: 0.9rem;
            font-weight: 600;
            color: #253746;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* Centralized Animation System */
        @keyframes subtle-pulse {
            0%, 100% { 
                box-shadow: 0 8px 24px rgba(200, 16, 46, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 8px 32px rgba(200, 16, 46, 0.4);
                transform: scale(1.02);
            }
        }

        @keyframes gentle-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Get Started Section */
        .get-started-section {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(6, 95, 70, 0.05) 100%);
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.6s ease-out;
        }

        .get-started-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }

        .get-started-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #065f46;
            margin-bottom: 16px;
        }

        .get-started-subtitle {
            font-size: 1.1rem;
            color: #4a5568;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .get-started-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .get-started-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .get-started-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }

        .btn-icon {
            font-size: 1.2rem;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Hero Section */
        @media (max-width: 1024px) {
            .hero-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .hero-title {
                font-size: 2rem;
            }

            .hero-features {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .hero-section {
                padding: 30px 20px;
                margin-bottom: 30px;
            }

            .hero-title {
                font-size: 1.75rem;
            }

            .hero-subtitle {
                font-size: 1.1rem;
            }

            .hero-cta-button {
                padding: 18px 28px;
                font-size: 1rem;
            }

            .hero-illustration {
                width: 150px;
                height: 150px;
            }

            .floating-card {
                padding: 12px 16px;
            }
        }

        @media (max-width: 480px) {
            .hero-section {
                padding: 25px 15px;
            }

            .hero-title {
                font-size: 1.5rem;
            }

            .hero-subtitle {
                font-size: 1rem;
            }

            .hero-features {
                gap: 15px;
            }

            .hero-feature {
                padding: 12px 16px;
            }

            .hero-cta-button {
                padding: 16px 24px;
                flex-direction: column;
                gap: 8px;
            }

            .get-started-section {
                padding: 25px 15px;
            }

            .get-started-title {
                font-size: 1.5rem;
            }

            .get-started-subtitle {
                font-size: 1rem;
            }

            .get-started-actions {
                flex-direction: column;
                align-items: center;
            }

            .get-started-btn {
                width: 100%;
                max-width: 280px;
                justify-content: center;
            }
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            display: block;
            visibility: visible;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #253746 0%, #C8102E 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover::before {
            opacity: 1;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #253746;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        /* Action Buttons - Centralized System */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        /* Base Button Styles - Reusable Foundation */
        .action-btn {
            background: linear-gradient(135deg, #253746 0%, #1a2a38 100%);
            border: 1px solid #253746;
            color: white;
            padding: 14px 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(37, 55, 70, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Reusable Button Elements */
        .btn-icon {
            font-size: 1.1rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .btn-text {
            font-weight: 600;
        }

        .btn-arrow {
            font-size: 1rem;
            transition: transform 0.3s ease;
        }

        /* Button Hover Effects - Centralized */
        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 55, 70, 0.4);
        }

        .action-btn:hover .btn-arrow {
            transform: translateX(4px);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, #1a2a38 0%, #253746 100%);
            border-color: #1a2a38;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 55, 70, 0.4);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #C8102E 0%, #a30d25 100%);
            color: white;
            border-color: #C8102E;
            box-shadow: 0 4px 12px rgba(200, 16, 46, 0.3);
        }

        .action-btn.primary:hover {
            background: linear-gradient(135deg, #a30d25 0%, #C8102E 100%);
            border-color: #a30d25;
            box-shadow: 0 6px 20px rgba(200, 16, 46, 0.4);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            border-color: #4a5568;
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.3);
        }

        .action-btn.secondary:hover {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border-color: #2d3748;
            box-shadow: 0 6px 20px rgba(74, 85, 104, 0.4);
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .action-btn:disabled::before {
            display: none;
        }

        /* Table Styles - Consolidated */
        .claims-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .claims-table th,
        .claims-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
        }

        .claims-table th {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            font-weight: 600;
            color: #253746;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .claims-table tr {
            transition: all 0.2s ease;
        }

        .claims-table tr:hover {
            background: rgba(247, 250, 252, 0.8);
            transform: scale(1.01);
        }

        .claims-table tr:last-child td {
            border-bottom: none;
        }

        /* Status colors for transactions */
        .status-pending {
            color: #d69e2e;
            font-weight: 600;
            background: rgba(254, 243, 199, 0.3);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.85rem;
        }

        .status-approved {
            color: #38a169;
            font-weight: 600;
            background: rgba(198, 246, 213, 0.3);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.85rem;
        }

        .status-error {
            color: #e53e3e;
            font-weight: 600;
            background: rgba(254, 215, 215, 0.3);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            font-size: 0.85rem;
        }

        /* Task Styles */
        .task-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            border-radius: 12px;
            border-left: 4px solid #C8102E;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .task-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .task-item:hover::before {
            left: 100%;
        }

        .task-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(200, 16, 46, 0.2);
        }

        .task-text {
            flex: 1;
            color: #742a2a;
            font-weight: 500;
        }

        .help-icon {
            cursor: pointer;
            color: #d69e2e;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            padding: 8px;
            border-radius: 50%;
            background: rgba(254, 243, 199, 0.3);
        }

        .help-icon:hover {
            color: #b7791f;
            transform: scale(1.1);
            background: rgba(254, 243, 199, 0.5);
        }

        /* HSA Planner Styles */
        .goal-tags {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .goal-tag {
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .goal-tag::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .goal-tag:hover::before {
            left: 100%;
        }

        .goal-tag.primary {
            background: linear-gradient(135deg, #c6f6d5 0%, #9ae6b4 100%);
            color: #22543d;
            box-shadow: 0 2px 8px rgba(198, 246, 213, 0.4);
        }

        .goal-tag.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(198, 246, 213, 0.6);
        }

        .goal-tag.secondary {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
            color: #4a5568;
            box-shadow: 0 2px 8px rgba(226, 232, 240, 0.4);
        }

        .goal-tag.secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(226, 232, 240, 0.6);
        }

        .goal-amount {
            margin-bottom: 20px;
        }

        .amount-text {
            font-size: 1.75rem;
            font-weight: 700;
            color: #253746;
            background: linear-gradient(135deg, #253746 0%, #C8102E 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .goal-status {
            margin-bottom: 20px;
        }

        .status-text {
            color: #C8102E;
            font-weight: 600;
            background: rgba(200, 16, 46, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
        }

        .goal-message {
            color: #4a5568;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .expenses-text {
            color: #718096;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .goal-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .progress-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #4a5568;
            font-weight: 500;
        }

        .progress-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 4px solid #e2e8f0;
            position: relative;
            overflow: hidden;
            background: conic-gradient(#C8102E 0deg 144deg, #e2e8f0 144deg 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #253746;
            font-size: 0.8rem;
        }

        .progress-circle::before {
            content: '';
            position: absolute;
            width: 35px;
            height: 35px;
            background: white;
            border-radius: 50%;
        }

        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, #C8102E 0%, #a30d25 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(200, 16, 46, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(200, 16, 46, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(74, 85, 104, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-secondary:hover::before {
            left: 100%;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 85, 104, 0.4);
        }

        /* Overlay Styles - REMOVED: No longer used */
        /* These styles were for the old authOverlay system that has been replaced */

        .hidden {
            display: none;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #38a169;
        }

        .error-message {
            background: #fed7d7;
            color: #742a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #e53e3e;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .nav-center {
                display: none;
            }
            
            .action-buttons {
                flex-direction: column;
            }

            .main-content {
                padding: 20px;
            }

            .card {
                padding: 20px;
                border-radius: 12px;
            }

            .modal-content {
                width: 95%;
                max-width: none;
                margin: 20px;
                border-radius: 16px;
            }

            .modal-header,
            .modal-body,
            .modal-footer {
                padding: 20px;
            }

            .goal-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .progress-info {
                justify-content: center;
            }

            .claims-table {
                font-size: 0.9rem;
            }

            .claims-table th,
            .claims-table td {
                padding: 12px 8px;
            }
        }

        @media (max-width: 480px) {
            .nav-container {
                padding: 15px 20px;
            }

            .logo {
                font-size: 1.25rem;
            }

            .main-content {
                padding: 15px;
            }

            .card {
                padding: 15px;
            }

            .action-btn {
                padding: 12px 20px;
                font-size: 0.85rem;
            }

            .modal-content {
                margin: 10px;
                border-radius: 12px;
            }

            .modal-header,
            .modal-body,
            .modal-footer {
                padding: 15px;
            }
        }

        /* Centralized Theme System */
        :root {
            /* Primary Colors */
            --color-primary: #253746;
            --color-primary-light: #1a2a38;
            --color-accent: #C8102E;
            --color-accent-light: #a30d25;
            
            /* Neutral Colors */
            --color-text-primary: #253746;
            --color-text-secondary: #4a5568;
            --color-text-muted: #718096;
            
            /* Background Colors */
            --color-bg-primary: #ffffff;
            --color-bg-secondary: #f8fafc;
            --color-bg-muted: rgba(37, 55, 70, 0.02);
            
            /* Border Colors */
            --color-border-primary: rgba(37, 55, 70, 0.1);
            --color-border-secondary: rgba(226, 232, 240, 0.6);
            
            /* Shadow Colors */
            --color-shadow-primary: rgba(37, 55, 70, 0.15);
            --color-shadow-accent: rgba(200, 16, 46, 0.3);
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
            --gradient-accent: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-light) 100%);
            --gradient-subtle: linear-gradient(135deg, var(--color-bg-muted) 0%, rgba(200, 16, 46, 0.02) 100%);
            
            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.6s ease;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }

        /* Centralized Utility Classes */
        .gradient-border-top {
            position: relative;
            overflow: hidden;
        }

        .gradient-border-top::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0.8;
        }

        .subtle-bg {
            background: var(--gradient-subtle);
        }

        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .hover-lift {
            transition: all var(--transition-normal);
        }

        .hover-lift:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px var(--color-shadow-primary);
        }

        /* Enhanced Pre-Authentication Message Section */
        .pre-auth-message {
            composes: subtle-bg gradient-border-top;
            border: 2px solid rgba(37, 55, 70, 0.1);
        }

        .pre-auth-content {
            text-align: center;
            padding: 20px 0;
        }

        .pre-auth-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
            animation: gentle-bounce 2s ease-in-out infinite;
        }

        @keyframes gentle-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .pre-auth-message h3 {
            font-size: 1.8rem;
            font-weight: 700;
            color: #253746;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #253746 0%, #C8102E 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .pre-auth-message p {
            font-size: 1.1rem;
            color: #4a5568;
            margin-bottom: 25px;
            line-height: 1.6;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .pre-auth-benefits {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .benefit-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(248, 250, 252, 0.8) 100%);
            border-radius: 12px;
            border: 1px solid rgba(37, 55, 70, 0.1);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .benefit-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(37, 55, 70, 0.15);
            border-color: rgba(37, 55, 70, 0.2);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.95) 100%);
        }

        .benefit-icon {
            font-size: 1.8rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .benefit-item span:last-child {
            font-weight: 600;
            color: #253746;
            font-size: 1rem;
        }

        .pre-auth-action {
            text-align: center;
            margin-top: 30px;
        }

        .pre-auth-cta-button {
            /* Use centralized button styles */
            composes: action-btn primary;
            margin: 0 auto 16px auto;
            animation: subtle-pulse 3s ease-in-out infinite;
        }

        .cta-subtitle {
            color: #718096;
            font-size: 0.95rem;
            font-style: italic;
            margin: 0;
        }

        /* Responsive Pre-Auth Section */
        @media (max-width: 768px) {
            .pre-auth-message h3 {
                font-size: 1.5rem;
            }

            .pre-auth-message p {
                font-size: 1rem;
            }

            .pre-auth-benefits {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .benefit-item {
                padding: 15px 18px;
            }

            .pre-auth-cta-button {
                padding: 18px 28px;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .pre-auth-content {
                padding: 15px 0;
            }

            .pre-auth-icon {
                font-size: 2.5rem;
            }

            .pre-auth-message h3 {
                font-size: 1.3rem;
            }

            .pre-auth-message p {
                font-size: 0.95rem;
            }

            .pre-auth-cta-button {
                padding: 16px 24px;
                flex-direction: column;
                gap: 8px;
            }
        }

        /* Enhanced Checkbox Styles */
        .checkbox-label {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            cursor: pointer;
            padding: 8px 0;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .checkbox-label:hover {
            color: #253746;
        }

        .checkbox-label input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid #cbd5e0;
            border-radius: 4px;
            background: white;
            position: relative;
            transition: all 0.3s ease;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark {
            background: linear-gradient(135deg, #C8102E 0%, #a30d25 100%);
            border-color: #C8102E;
            box-shadow: 0 2px 8px rgba(200, 16, 46, 0.3);
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .checkbox-label:hover .checkmark {
            border-color: #253746;
            transform: scale(1.05);
        }

        .checkbox-label a {
            color: #C8102E;
            text-decoration: underline;
            transition: color 0.2s ease;
        }

        .checkbox-label a:hover {
            color: #a30d25;
        }

        /* Enhanced Form Elements */
        .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .form-select:hover {
            border-color: #cbd5e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .form-help {
            display: block;
            margin-top: 6px;
            font-size: 0.85rem;
            color: #718096;
            font-style: italic;
            line-height: 1.4;
        }

        .form-select:focus {
            outline: none;
            border-color: #253746;
            box-shadow: 0 0 0 3px rgba(37, 55, 70, 0.1);
            transform: translateY(-1px);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:hover {
            border-color: #cbd5e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .form-input:focus {
            outline: none;
            border-color: #253746;
            box-shadow: 0 0 0 3px rgba(37, 55, 70, 0.1);
            transform: translateY(-1px);
        }

        .form-input::placeholder {
            color: #a0aec0;
            font-style: italic;
        }

        /* Loading States and Animations */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #C8102E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Enhanced Success and Error Messages */
        .success-message {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #10b981;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.2);
            animation: slideInRight 0.5s ease-out;
        }

        .error-message {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            color: #742a2a;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #e53e3e;
            box-shadow: 0 4px 16px rgba(229, 62, 62, 0.2);
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Enhanced Focus States for Accessibility */
        .action-btn:focus,
        .btn-primary:focus,
        .btn-secondary:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 55, 70, 0.3);
        }

        .form-select:focus,
        .form-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 55, 70, 0.2);
        }

        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Selection Styling */
        ::selection {
            background: rgba(200, 16, 46, 0.2);
            color: #253746;
        }

        ::-moz-selection {
            background: rgba(200, 16, 46, 0.2);
            color: #253746;
        }

        /* Notification Toast System */
        .notification-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .notification-toast.show {
            transform: translateX(0);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            color: white;
            font-weight: 500;
        }

        .notification-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .notification-message {
            flex: 1;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            flex-shrink: 0;
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .notification-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .notification-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .notification-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .notification-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        /* Enhanced Form Error States */
        .form-select.error,
        .form-input.error {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Enhanced Loading States */
        .loading {
            position: relative;
            opacity: 0.7;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #C8102E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Enhanced Hover Effects */
        .card:hover .card::before {
            opacity: 1;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .goal-tag:hover {
            transform: translateY(-2px);
        }

        .task-item:hover {
            transform: translateX(4px);
        }

        /* Enhanced Focus States */
        .action-btn:focus,
        .btn-primary:focus,
        .btn-secondary:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 55, 70, 0.3);
        }

        .form-select:focus,
        .form-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 55, 70, 0.2);
        }

        /* Enhanced Mobile Experience */
        @media (max-width: 768px) {
            .notification-toast {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                transform: translateY(-100%);
            }

            .notification-toast.show {
                transform: translateY(0);
            }

            .card:hover {
                transform: none;
            }

            .action-btn:hover {
                transform: none;
            }

            .goal-tag:hover {
                transform: none;
            }

            .task-item:hover {
                transform: none;
            }
        }

        /* Enhanced Print Styles */
        @media print {
            .workflow-modal,
            .notification-toast,
            .action-buttons,
            .nav-container {
                display: none !important;
            }

            .card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #e2e8f0;
            }

            body {
                background: white;
                color: black;
            }
        }

        /* Enhanced High Contrast Mode */
        @media (prefers-contrast: high) {
            .card {
                border: 2px solid #000;
            }

            .action-btn {
                border: 2px solid currentColor;
            }

            .form-select,
            .form-input {
                border: 2px solid #000;
            }
        }

        /* Enhanced Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            .notification-toast {
                transition: none;
            }

            .card:hover {
                transform: none;
            }

            .action-btn:hover {
                transform: none;
            }
        }

        /* ========================================
           WORKFLOW MODAL SYSTEM - SPLASH SCREENS
           ======================================== */
        /* These styles ONLY affect the 4-step workflow modals */
        /* They are completely separate from the portal interface */
        
        .workflow-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .workflow-modal.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: -1;
        }

        .workflow-modal:not(.hidden) {
            opacity: 1;
            visibility: visible;
            z-index: 1000;
        }
        
        /* Ensure main content stays visible behind modals */
        .main-content,
        header,
        .alerts-section {
            z-index: 1;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 550px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .workflow-modal:not(.hidden) .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: 28px 28px 20px 28px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 20px 20px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            color: #253746;
            font-size: 1.35rem;
            font-weight: 700;
            background: linear-gradient(135deg, #253746 0%, #C8102E 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-close {
            background: rgba(241, 245, 249, 0.8);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(226, 232, 240, 0.9);
            color: #253746;
            transform: scale(1.1);
        }

        .modal-body {
            padding: 28px;
        }

        .modal-footer {
            padding: 20px 28px 28px 28px;
            border-top: 1px solid rgba(226, 232, 240, 0.6);
            display: flex;
            justify-content: flex-end;
            gap: 16px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 0 0 20px 20px;
        }

        /* Enhanced Form Elements in Modals */
        .modal-body .form-group {
            margin-bottom: 28px;
        }

        .modal-body .form-group label {
            color: #253746;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .modal-body .form-select,
        .modal-body .form-input {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 16px 18px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .modal-body .form-select:hover,
        .modal-body .form-input:hover {
            border-color: #cbd5e0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .modal-body .form-select:focus,
        .modal-body .form-input:focus {
            border-color: #253746;
            box-shadow: 0 0 0 4px rgba(37, 55, 70, 0.1);
            transform: translateY(-2px);
        }

        /* Provider Logo and Display Name */
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        .provider-logo {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            margin-bottom: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .auth-header h4 {
            margin: 0;
            color: #253746;
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 24px;
        }

        .forgot-password {
            color: #C8102E;
            text-decoration: none;
            font-size: 0.9rem;
            text-align: center;
            transition: all 0.2s ease;
        }

        .forgot-password:hover {
            color: #a30d25;
            text-decoration: underline;
        }

        /* Progress Modal Enhancements */
        .progress-content {
            text-align: center;
            padding: 20px 0;
        }

        .progress-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #C8102E;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 24px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-content h4 {
            color: #253746;
            font-size: 1.25rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .oauth-step {
            margin-bottom: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border: 1px solid rgba(209, 213, 219, 0.5);
            transition: all 0.3s ease;
        }

        .oauth-step.completed {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
            color: #065f46;
        }

        .oauth-step.active {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #3b82f6;
            color: #1e40af;
        }

        /* Success Modal Enhancements */
        .success-content {
            text-align: center;
            padding: 20px 0;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: successBounce 0.6s ease-out;
        }

        @keyframes successBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .success-content h4 {
            color: #253746;
            font-size: 1.35rem;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .success-content p {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <script type="module" src="./config.js"></script>
    <div class="app">
        <header class="main-header">
            <div class="nav-container">
                <div class="nav-left">
                    <h1 class="logo">wex BENEFITS</h1>
                </div>
                <nav class="nav-center">
                    <a href="#" class="nav-link active" onclick="showComingSoon('Home')">Home</a>
                    <a href="#" class="nav-link" onclick="showComingSoon('Accounts')">Accounts</a>
                    <a href="#" class="nav-link" onclick="showComingSoon('Videos & Forms')">Videos & Forms</a>
                    <a href="#" class="nav-link" onclick="showComingSoon('Message Center')">
                        Message Center
                        <span class="notification-badge">2</span>
                    </a>
                </nav>
                <div class="nav-right">
                    <div class="user-menu" onclick="showComingSoon('User Profile')">
                        <span class="user-icon">ðŸ‘¤</span>
                        <span>Olivia Brown</span>
                        <span class="dropdown-arrow">â–¼</span>
                    </div>
                    <div class="cart-icon" onclick="showComingSoon('Shopping Cart')">
                        ðŸ›’
                        <span class="notification-badge">0</span>
                    </div>
                    <a href="#" class="logout-link" onclick="showComingSoon('Logout')">Logout</a>
                </div>
            </div>
        </header>

        <div class="alerts-section">
            <div class="alert alert-warning">
                <span class="alert-icon">âš ï¸</span>
                <span class="alert-text" id="receiptsAlertText">2 receipt(s) needed to approve your debit card transaction(s) or claim(s)</span>
                <a href="#" class="alert-link" onclick="showComingSoon('View More')">View More</a>
                <button class="alert-close" onclick="closeAlert(this)">Ã—</button>
            </div>
            
            <div class="alert alert-info">
                <span class="alert-icon">ðŸ“±</span>
                <span class="alert-text">Download our mobile app. An easy way to get reimbursed, upload documents, and scan items for eligibility on the go.</span>
                <button class="btn-primary" onclick="showComingSoon('Download Mobile App')">Download now</button>
                <span class="arrow-right">â†’</span>
            </div>
        </div>

        <main class="main-content">
            <div class="content-grid">
                <!-- Left Column -->
                <div class="left-column">
                    <!-- I Want To Section -->
                    <div class="card action-buttons-section">
                        <h2>I Want To:</h2>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="showComingSoon('Get Help')">Get Help</button>
                            <button class="action-btn" onclick="showComingSoon('Reimburse Myself')">Reimburse Myself</button>
                            <button class="action-btn" onclick="showComingSoon('Send Payment')">Send Payment</button>
                            <button class="action-btn" onclick="showComingSoon('Manage My Expenses')">Manage My Expenses</button>
                            <button class="action-btn primary" id="connectProviderBtn" onclick="handleConnectProvider()" onmouseover="this.style.cursor='pointer'" onmouseout="this.style.cursor='default'">Connect My Provider</button>
                            
                            <!-- Development/Test buttons - hidden in production -->
                            <div class="dev-buttons" style="display: none;">
                                <button class="action-btn" onclick="devHelpers.testConnectProvider()" style="margin-top: 10px; font-size: 0.9em; background-color: #6b7280;">ðŸ§ª Test Connect</button>
                                <button class="action-btn" onclick="devHelpers.testSubmitTerms()" style="margin-top: 10px; font-size: 0.9em; background-color: #6b7280;">ðŸ§ª Test Submit</button>
                                <button class="action-btn" onclick="devHelpers.testModal('termsModal')" style="margin-top: 10px; font-size: 0.9em; background-color: #6b7280;">ðŸ§ª Test Modal</button>
                                <button class="action-btn" onclick="devHelpers.showFHIRDocs()" style="margin-top: 10px; font-size: 0.9em; background-color: #059669;">ðŸ“š FHIR OAuth Docs</button>
                                <button class="action-btn" onclick="devHelpers.testFHIRFlow()" style="margin-top: 10px; font-size: 0.9em; background-color: #dc2626;">ðŸš€ Test FHIR Flow</button>
                                <button class="action-btn" onclick="devHelpers.forceReloadConfigs()" style="margin-top: 10px; font-size: 0.9em; background-color: #7c3aed;">ðŸ”„ Reload Configs</button>
                                <button class="action-btn" onclick="window.debugConnectedProviders()" style="margin-top: 10px; font-size: 0.9em; background-color: #059669;">ðŸ” Debug Providers</button>
                                <button class="action-btn" onclick="window.debugProviderNameElements()" style="margin-top: 10px; font-size: 0.9em; background-color: #7c3aed;">ðŸ” Debug Provider Names</button>
                                <button class="action-btn" onclick="window.debugAddAnotherProviderWorkflow()" style="margin-top: 10px; font-size: 0.9em; background-color: #dc2626;">ðŸ” Debug Add Another Provider</button>
                            </div>
                        </div>
                    </div>

                    <!-- Pre-Authentication Message -->
                    <div class="card pre-auth-message" id="preAuthMessage">
                        <div class="pre-auth-content">
                            <div class="pre-auth-icon">ðŸ¥</div>
                            <h3>Connect Your Provider to Get Started</h3>
                            <p>To view your provider claims and enable automatic verification, you'll need to connect your healthcare provider first.</p>
                            <div class="pre-auth-benefits">
                                <div class="benefit-item">
                                    <span class="benefit-icon">âš¡</span>
                                    <span>Real-time claim updates</span>
                                </div>
                                <div class="benefit-item">
                                    <span class="benefit-icon">âœ…</span>
                                    <span>Automatic verification</span>
                                </div>
                                <div class="benefit-item">
                                    <span class="benefit-icon">ðŸ’°</span>
                                    <span>Zero-touch approval</span>
                                </div>
                            </div>
                            
                            <!-- Enhanced Action Button -->
                            <div class="pre-auth-action">
                                <button class="pre-auth-cta-button" onclick="handleConnectProvider()">
                                    <span class="cta-icon">ðŸ¥</span>
                                    <span class="cta-text">Connect My Provider</span>
                                    <span class="cta-arrow">â†’</span>
                                </button>
                                <p class="cta-subtitle">Get started in just a few clicks</p>
                            </div>
                        </div>
                    </div>

                    <!-- Provider Claims Section -->
                    <div class="card provider-claims-section hidden" id="providerClaimsSection">
                        <h2>My Provider Claims</h2>
                        <div id="successMessage" class="success-message hidden">
                            âœ… Successfully connected to <span id="providerName"></span>
                        </div>
                        <div id="errorMessage" class="error-message hidden">
                            âŒ Connection failed. Please try again.
                        </div>
                        <table class="claims-table">
                            <thead>
                                <tr>
                                    <th>Provider</th>
                                    <th>Date of Service</th>
                                    <th>Patient Responsibility</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="claimsTableBody">
                                <!-- Claims will be populated here -->
                            </tbody>
                        </table>
                        
                        <!-- Add Another Provider Button -->
                        <div class="add-provider-section" style="margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(226, 232, 240, 0.6);">
                            <button class="action-btn secondary" id="addAnotherProviderBtn" onclick="handleAddAnotherProvider()">
                                âž• Add Another Provider
                            </button>
                            <small class="form-help" style="display: block; margin-top: 8px; color: #718096;">
                                Connect additional healthcare providers to consolidate all your claims in one place
                            </small>
                        </div>
                    </div>

                    <!-- Tasks Section -->
                    <div class="card tasks-section">
                        <h2>Tasks <span class="notification-badge">1</span></h2>
                        <div class="task-item">
                            <span class="task-icon">âš ï¸</span>
                            <span class="task-text">2 receipt(s) needed to approve your debit card transaction(s) or claim(s)</span>
                            <span class="help-icon" onclick="showComingSoon('Help')">â“</span>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="right-column">
                    <!-- HSA Planner Section -->
                    <div class="card hsa-planner-section">
                        <h2>My HSA Planner</h2>
                        <div class="goal-tags">
                            <span class="goal-tag primary">2025 Goal</span>
                            <span class="goal-tag secondary">Long Term Goal</span>
                        </div>
                        <div class="goal-amount">
                            <span class="amount-text">$1,905.00 of $4,792.00</span>
                        </div>
                        <div class="goal-status">
                            <span class="status-text">Goal Status: Off Track</span>
                        </div>
                        <p class="goal-message">To meet your goal, you need to contribute a bit more each week. You can do it!</p>
                        <p class="expenses-text">Estimated out of pocket expenses: $4,791.97</p>
                        <div class="goal-actions">
                            <button class="btn-secondary" onclick="showComingSoon('Update My Goal')">Update My Goal</button>
                            <div class="progress-info">
                                <span>40% to your goal</span>
                                <div class="progress-circle">
                                    <div class="progress-fill" style="width: 40%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Connect My Provider Workflow Modals -->
        
        <!-- Step 1: Terms and Conditions Modal -->
        <div id="termsModal" class="workflow-modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Connect My Provider</h3>
                    <button class="modal-close" onclick="modalManager.hide('termsModal')">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="providerSelect">Select Provider:</label>
                        <select id="providerSelect" class="form-select">
                            <option value="">Select My Provider</option>
                            <option value="trellis">Trellis Healthcare</option>
                            <option value="epic">Epic Systems</option>
                            <option value="cerner">Cerner Corporation</option>
                        </select>
                        <small class="form-help">Selected provider will determine the terms and conditions you agree to.</small>
                    </div>
                    <div class="form-group" id="termsSection" style="display: none;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="termsCheckbox" required>
                            <span class="checkmark"></span>
                            I agree to <a href="#" onclick="showTerms()" id="termsLink">Terms and Conditions</a>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="modalManager.hide('termsModal')">Close</button>
                    <button class="btn-primary" id="submitTermsBtn" onclick="submitTerms()" disabled>Submit</button>
                </div>
            </div>
        </div>

        <!-- Step 2: External Authentication Modal -->
        <div id="authModal" class="workflow-modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Connect My Provider</h3>
                    <button class="modal-close" onclick="modalManager.hide('authModal')">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="auth-header">
                        <img id="providerLogo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzAwQzdCMiIvPgo8cGF0aCBkPSJNMTIgMjBMMTggMjYMMjggMTQiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo=" alt="Provider Logo" class="provider-logo">
                        <h4 id="providerDisplayName">trellishealth</h4>
                    </div>
                    <form id="authForm" onsubmit="handleAuthSubmit(event)">
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" id="username" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" class="form-input" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Sign In</button>
                            <a href="#" class="forgot-password">Forgot Password?</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Step 3: Connection Progress Modal -->
        <div id="progressModal" class="workflow-modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Connect My Provider</h3>
                </div>
                <div class="modal-body">
                    <div class="progress-content">
                        <div class="progress-spinner"></div>
                        <h4>FHIR OAuth Integration in Progress...</h4>
                        <div id="oauthSteps" style="text-align: left; margin-top: 20px;">
                            <div class="oauth-step" style="margin-bottom: 10px; padding: 8px; border-radius: 4px; background: #f3f4f6;">
                                <span style="color: #6b7280;">â³ Step 1: Authorization Request</span>
                            </div>
                            <div class="oauth-step" style="margin-bottom: 10px; padding: 8px; border-radius: 4px; background: #f3f4f6;">
                                <span style="color: #6b7280;">â³ Step 2: User Consent & Redirect</span>
                            </div>
                            <div class="oauth-step" style="margin-bottom: 10px; padding: 8px; border-radius: 4px; background: #f3f4f6;">
                                <span style="color: #6b7280;">â³ Step 3: Token Exchange</span>
                            </div>
                            <div class="oauth-step" style="margin-bottom: 10px; padding: 8px; border-radius: 4px; background: #f3f4f6;">
                                <span style="color: #6b7280;">â³ Step 4: FHIR Resource Access</span>
                            </div>
                        </div>
                        <p style="margin-top: 20px; font-size: 0.9em; color: #6b7280;">
                            <strong>Demo Mode:</strong> This simulates the complete FHIR OAuth 2.0 flow
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Success Confirmation Modal -->
        <div id="successModal" class="workflow-modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Connect My Provider</h3>
                    <button class="modal-close" onclick="modalManager.hide('successModal')">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="success-content">
                        <div class="success-icon">âœ…</div>
                        <h4>Connection Successful!</h4>
                        <p>You have successfully connected to <strong id="connectedProviderName">your selected provider</strong>.</p>
                        <p>Your provider claims will now be automatically verified.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" onclick="completeConnection()">Continue</button>
                </div>
            </div>
        </div>

        <!-- Authentication Overlay (Legacy - keeping for fallback) -->
        <!-- REMOVED: This overlay system is no longer used and could cause conflicts -->
    </div>

    <script>
        /* ========================================
           MODAL MANAGEMENT SYSTEM
           ========================================
           
           PURPOSE: This system ONLY manages the 4-step workflow modals
           (Terms, Auth, Progress, Success). It does NOT affect portal elements.
           
           WHY: Prevents the "black screen" issue where modals cover everything.
           
           HOW: 
           - Only registers elements with class 'workflow-modal'
           - Ensures only one modal is active at a time
           - Protects main content visibility during modal display
           
           FUTURE DEVELOPMENT: 
           - Add new modals by giving them class 'workflow-modal'
           - Don't modify portal element visibility here
           - Use devHelpers for debugging if issues arise
           ======================================== */
        
        // Modal Management System - Prevents visibility issues
        class ModalManager {
            constructor() {
                this.modals = new Map();
                this.activeModal = null;
                this.init();
            }

            init() {
                // Only register workflow modals, not portal elements
                const modalElements = document.querySelectorAll('.workflow-modal');
                modalElements.forEach(modal => {
                    this.modals.set(modal.id, modal);
                    this.hide(modal.id);
                });
                console.log('ðŸ”§ ModalManager: Registered', modalElements.length, 'workflow modals');
            }

            show(modalId) {
                // Hide any currently active modal first
                if (this.activeModal) {
                    this.hide(this.activeModal);
                }

                const modal = this.modals.get(modalId);
                if (modal) {
                    modal.classList.remove('hidden');
                    this.activeModal = modalId;
                    console.log('ðŸ”§ ModalManager: Showing modal', modalId);
                    
                    // Ensure main content is not interfered with
                    this.protectMainContent();
                } else {
                    console.error(`ModalManager: Workflow modal ${modalId} not found`);
                }
            }

            hide(modalId) {
                const modal = this.modals.get(modalId);
                if (modal) {
                    modal.classList.add('hidden');
                    if (this.activeModal === modalId) {
                        this.activeModal = null;
                    }
                    console.log('ðŸ”§ ModalManager: Hiding modal', modalId);
                    
                    // Restore main content visibility
                    this.restoreMainContent();
                }
            }

            hideAll() {
                this.modals.forEach((modal, id) => {
                    this.hide(id);
                });
                console.log('ðŸ”§ ModalManager: All modals hidden');
            }

            protectMainContent() {
                // Ensure main content is visible but behind modal
                // CSS already handles this with z-index: 1
            }

            restoreMainContent() {
                // Restore main content to normal state
                // CSS already handles this with z-index: 1
            }

            // Debug method for development
            debug() {
                console.log('ðŸ”§ ModalManager Debug:');
                console.log('  Active modal:', this.activeModal);
                console.log('  Total modals:', this.modals.size);
                this.modals.forEach((modal, id) => {
                    const isHidden = modal.classList.contains('hidden');
                    const computedStyle = window.getComputedStyle(modal);
                    console.log(`  Modal ${id}:`, {
                        hidden: isHidden,
                        display: computedStyle.display,
                        visibility: computedStyle.visibility,
                        opacity: computedStyle.opacity,
                        zIndex: computedStyle.zIndex
                    });
                });
            }
        }

        // Initialize modal manager
        const modalManager = new ModalManager();
        
        // Make modalManager globally accessible for debugging
        window.modalManager = modalManager;
        
        // Debug: Log modal manager status
        console.log('ðŸ”§ ModalManager initialized:', modalManager);
        console.log('ðŸ”§ Available modals:', Array.from(modalManager.modals.keys()));
        
        // Alias global configs loaded from config.js
        const { PROVIDER_CONFIG, APP_CONFIG } = window;
        
        // Fallback event listener for Connect My Provider button
        document.addEventListener('DOMContentLoaded', () => {
            const connectBtn = document.getElementById('connectProviderBtn');
            if (connectBtn) {
                // Remove existing onclick to prevent conflicts
                connectBtn.removeAttribute('onclick');
                
                // Add event listener
                connectBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('ðŸ” Connect button clicked via event listener');
                    
                    try {
                        handleConnectProvider();
                    } catch (error) {
                        console.error('âŒ Error in event listener:', error);
                        // Emergency fallback - use ModalManager
                        try {
                            if (window.modalManager) {
                                window.modalManager.show('termsModal');
                                console.log('ðŸš¨ Emergency modal show via ModalManager in event listener');
                            } else {
                                console.error('âŒ ModalManager not available for emergency fallback');
                            }
                        } catch (fallbackError) {
                            console.error('âŒ Emergency fallback failed:', fallbackError);
                        }
                    }
                });
                
                console.log('âœ… Connect button event listener added');
            } else {
                console.warn('âš ï¸ Connect button not found for event listener');
            }
        });

        // Provider Configuration - centralized in config.js (loaded as module at top)

        // Global variable to track selected provider
        let selectedProvider = (APP_CONFIG && APP_CONFIG.DEFAULT_PROVIDER) || 'trellis';
        
        // Global array to track connected providers
        let connectedProviders = [];

        // Configuration object for the application
        // App Configuration - centralized in config.js (loaded as module at top)

        let eventSource = null;

        // Workflow Functions - Now using ModalManager directly
        // Old showModal/closeModal functions removed to prevent conflicts

        // Portal interaction functions - make portal feel live
        function showComingSoon(feature) {
            // dev: feature requested
            alert(`ðŸš§ ${feature} - Coming Soon!\n\nThis feature is part of the full WEX BENEFITS portal. For this demo, please use the "Connect My Provider" functionality.`);
        }

        // Function to comprehensively reset all modals for a new provider
        function resetAllModalsForNewProvider() {
            try {
                console.log('ðŸ§¹ Resetting all modals for new provider...');
                
                // 1. Reset Terms Modal
                const termsSection = document.getElementById('termsSection');
                if (termsSection) {
                    termsSection.style.display = 'none';
                }
                
                // 2. Reset Authentication Modal
                const usernameInput = document.getElementById('username');
                const passwordInput = document.getElementById('password');
                const authForm = document.getElementById('authForm');
                
                if (usernameInput) {
                    usernameInput.value = '';
                    usernameInput.classList.remove('error', 'loading');
                }
                
                if (passwordInput) {
                    passwordInput.value = '';
                    passwordInput.classList.remove('error', 'loading');
                }
                
                if (authForm) {
                    // Reset any loading states on the form
                    const submitButton = authForm.querySelector('button[type="submit"]');
                    if (submitButton) {
                        submitButton.textContent = 'Sign In';
                        submitButton.disabled = false;
                        submitButton.classList.remove('loading');
                    }
                }
                
                // 3. Reset Progress Modal
                const oauthSteps = document.getElementById('oauthSteps');
                if (oauthSteps) {
                    // Reset all OAuth steps to initial state
                    const steps = oauthSteps.querySelectorAll('.oauth-step');
                    steps.forEach((step, index) => {
                        step.innerHTML = `<span style="color: #6b7280;">â³ Step ${index + 1}: ${getOAuthStepDescription(index + 1)}</span>`;
                        step.style.background = 'linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)';
                        step.style.border = '1px solid rgba(209, 213, 219, 0.5)';
                        step.classList.remove('active', 'completed');
                    });
                }
                
                // 4. Reset Success Modal
                const connectedProviderName = document.getElementById('connectedProviderName');
                if (connectedProviderName) {
                    connectedProviderName.textContent = 'your selected provider';
                }
                
                // 5. Reset Main Success Message Banner
                const providerNameElement = document.getElementById('providerName');
                if (providerNameElement) {
                    providerNameElement.textContent = '';
                }
                
                const successMessage = document.getElementById('successMessage');
                if (successMessage) {
                    successMessage.classList.add('hidden');
                }
                
                // 6. Reset Provider Display Elements
                const providerLogo = document.getElementById('providerLogo');
                const providerDisplayName = document.getElementById('providerDisplayName');
                
                if (providerLogo) {
                    // Reset to default logo
                    providerLogo.src = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzAwQzdCMiIvPgo8cGF0aCBkPSJNMTIgMjBMMTggMjYMMjggMTQiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMyIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjwvc3ZnPgo=";
                    providerLogo.alt = "Provider Logo";
                }
                
                if (providerDisplayName) {
                    providerDisplayName.textContent = 'trellishealth';
                }
                
                console.log('âœ… All modals reset successfully for new provider');
                
            } catch (error) {
                console.error('âŒ Error resetting modals:', error);
            }
        }
        
        // Helper function to get OAuth step descriptions
        function getOAuthStepDescription(stepNumber) {
            const descriptions = {
                1: 'Authorization Request',
                2: 'User Consent & Redirect',
                3: 'Token Exchange',
                4: 'FHIR Resource Access'
            };
            return descriptions[stepNumber] || 'Unknown Step';
        }

        // Function to handle adding another provider
        async function handleAddAnotherProvider() {
            try {
                console.log('ðŸ” Debug: handleAddAnotherProvider called');
                console.log('ðŸ” Debug: Connected providers:', connectedProviders);
                
                // Check if configs are loaded
                if (!window.PROVIDER_CONFIG || !window.APP_CONFIG) {
                    console.error('âŒ Config not loaded! PROVIDER_CONFIG:', window.PROVIDER_CONFIG, 'APP_CONFIG:', window.APP_CONFIG);
                    alert('Configuration not loaded. Please refresh the page and try again.');
                    return;
                }
                
                console.log('âœ… Configs loaded successfully');
                
                // Check if ModalManager is available
                if (!window.modalManager) {
                    console.error('âŒ ModalManager not available!');
                    alert('Modal system not initialized. Please refresh the page.');
                    return;
                }
                
                console.log('âœ… ModalManager available');
                
                // Check if the terms modal exists
                const termsModal = document.getElementById('termsModal');
                if (!termsModal) {
                    console.error('âŒ Terms modal not found!');
                    alert('Modal elements not found. Please refresh the page.');
                    return;
                }
                
                console.log('âœ… Terms modal found');
                
                // Reset workflow state for new provider
                window.selectedProviderForWorkflow = null;
                
                console.log('âœ… Workflow state reset for new provider');
                
                // Reset form elements with error checking
                const providerSelect = document.getElementById('providerSelect');
                const termsCheckbox = document.getElementById('termsCheckbox');
                const submitTermsBtn = document.getElementById('submitTermsBtn');
                
                if (providerSelect) {
                    // Filter out already connected providers
                    const availableProviders = Object.keys(window.PROVIDER_CONFIG).filter(
                        providerKey => !connectedProviders.includes(providerKey)
                    );
                    
                    if (availableProviders.length === 0) {
                        alert('All available providers are already connected!');
                        return;
                    }
                    
                    // Clear existing options and add filtered ones
                    providerSelect.innerHTML = '<option value="">Select My Provider</option>';
                    availableProviders.forEach(providerKey => {
                        const provider = window.PROVIDER_CONFIG[providerKey];
                        const option = document.createElement('option');
                        option.value = providerKey;
                        option.textContent = provider.name;
                        providerSelect.appendChild(option);
                    });
                    
                    console.log('âœ… Provider select filtered to available providers:', availableProviders);
                } else {
                    console.warn('âš ï¸ Provider select not found');
                }
                
                if (termsCheckbox) {
                    termsCheckbox.checked = false;
                    console.log('âœ… Terms checkbox reset');
                } else {
                    console.warn('âš ï¸ Terms checkbox not found');
                }
                
                if (submitTermsBtn) {
                    submitTermsBtn.disabled = true;
                    console.log('âœ… Submit button reset');
                } else {
                    console.warn('âš ï¸ Submit button not found');
                }
                
                // Update terms display to show available providers
                updateTermsDisplay();
                
                console.log('âœ… Terms display updated for available providers');
                
                console.log('âœ… About to show terms modal for additional provider');
                
                // Show the first modal
                modalManager.show('termsModal');
                
                console.log('âœ… Modal should be visible now for additional provider');
                
                // Ensure provider selection change handler is set up
                if (providerSelect) {
                    // Remove any existing change listeners to avoid duplicates
                    const newProviderSelect = providerSelect.cloneNode(true);
                    providerSelect.parentNode.replaceChild(newProviderSelect, providerSelect);
                    
                    // Add the change event listener to the new element
                    newProviderSelect.addEventListener('change', function() {
                        console.log('ðŸ” Provider selection changed to:', this.value);
                        if (this.value) {
                            window.selectedProviderForWorkflow = this.value;
                            console.log('âœ… Workflow provider set to:', this.value);
                            updateTermsDisplay();
                        }
                    });
                    
                    console.log('âœ… Provider selection change handler configured');
                }
                
            } catch (error) {
                console.error('âŒ Error in handleAddAnotherProvider:', error);
                alert('An error occurred while opening the additional provider connection. Check the console for details.');
            }
        }

        // Main provider connection function - Updated for workflow with error handling
        async function handleConnectProvider() {
            try {
                console.log('ðŸ” Debug: handleConnectProvider called');
                
                // Check if configs are loaded
                if (!window.PROVIDER_CONFIG || !window.APP_CONFIG) {
                    console.error('âŒ Config not loaded! PROVIDER_CONFIG:', window.PROVIDER_CONFIG, 'APP_CONFIG:', window.APP_CONFIG);
                    alert('Configuration not loaded. Please refresh the page and try again.');
                    return;
                }
                
                console.log('âœ… Configs loaded successfully');
                console.log('PROVIDER_CONFIG keys:', Object.keys(window.PROVIDER_CONFIG));
                console.log('APP_CONFIG:', window.APP_CONFIG);
                
                // Check if ModalManager is available
                if (!window.modalManager) {
                    console.error('âŒ ModalManager not available!');
                    alert('Modal system not initialized. Please refresh the page.');
                    return;
                }
                
                console.log('âœ… ModalManager available');
                
                // Check if the terms modal exists
                const termsModal = document.getElementById('termsModal');
                if (!termsModal) {
                    console.error('âŒ Terms modal not found!');
                    alert('Modal elements not found. Please refresh the page.');
                    return;
                }
                
                console.log('âœ… Terms modal found');
                
                                            // Reset workflow state
                window.selectedProviderForWorkflow = null; // Reset to no selection
                
                console.log('âœ… Workflow state reset');
                
                // Reset all modals for clean start
                resetAllModalsForNewProvider();
                
                // Reset form elements with error checking
                const providerSelect = document.getElementById('providerSelect');
                const termsCheckbox = document.getElementById('termsCheckbox');
                const submitTermsBtn = document.getElementById('submitTermsBtn');
                
                if (providerSelect) {
                    providerSelect.value = ''; // Reset to no selection
                    console.log('âœ… Provider select reset to no selection');
                } else {
                    console.warn('âš ï¸ Provider select not found');
                }
                
                if (termsCheckbox) {
                    termsCheckbox.checked = false;
                    console.log('âœ… Terms checkbox reset');
                } else {
                    console.warn('âš ï¸ Terms checkbox not found');
                }
                
                if (submitTermsBtn) {
                    submitTermsBtn.disabled = true;
                    console.log('âœ… Submit button reset');
                } else {
                    console.warn('âš ï¸ Submit button not found');
                }
                
                // Reset provider claims section to initial state
                const preAuthMessage = document.getElementById('preAuthMessage');
                const providerClaimsSection = document.getElementById('providerClaimsSection');
                const successMessage = document.getElementById('successMessage');
                const errorMessage = document.getElementById('errorMessage');
                const getStartedSection = document.getElementById('getStartedSection');
                
                if (preAuthMessage) {
                    preAuthMessage.style.display = 'block';
                    console.log('âœ… Pre-auth message reset');
                }
                
                if (providerClaimsSection) {
                    providerClaimsSection.classList.add('hidden');
                    console.log('âœ… Provider claims section hidden');
                }
                
                if (successMessage) {
                    successMessage.classList.add('hidden');
                    console.log('âœ… Success message hidden');
                }
                
                if (errorMessage) {
                    errorMessage.classList.add('hidden');
                    console.log('âœ… Error message hidden');
                }
                
                if (getStartedSection) {
                    getStartedSection.classList.add('hidden');
                    console.log('âœ… Get Started section hidden');
                }
                
                // Clear any existing claims data
                const claimsTableBody = document.getElementById('claimsTableBody');
                if (claimsTableBody) {
                    claimsTableBody.innerHTML = '';
                    console.log('âœ… Claims table cleared');
                }
                
                // Don't update terms display yet - wait for provider selection
                console.log('â„¹ï¸ Terms display will update when provider is selected');
                
                console.log('âœ… About to show terms modal');
                
                // Show the first modal
                modalManager.show('termsModal');
                
                console.log('âœ… Modal should be visible now');
                
                // Verify modal is visible
                setTimeout(() => {
                    const modal = document.getElementById('termsModal');
                    if (modal && !modal.classList.contains('hidden')) {
                        console.log('âœ… Modal is visible and working!');
                    } else {
                        console.error('âŒ Modal is not visible after modalManager.show call');
                        // Emergency fallback - use ModalManager
                        try {
                            modalManager.show('termsModal');
                            console.log('ðŸš¨ Emergency modal show via ModalManager');
                        } catch (fallbackError) {
                            console.error('âŒ Emergency fallback failed:', fallbackError);
                        }
                    }
                }, 100);
                
            } catch (error) {
                console.error('âŒ Error in handleConnectProvider:', error);
                alert('An error occurred while opening the provider connection. Check the console for details.');
                
                // Emergency fallback - try to show modal via ModalManager
                try {
                    if (window.modalManager) {
                        window.modalManager.show('termsModal');
                        console.log('ðŸš¨ Emergency modal show via ModalManager after error');
                    } else {
                        console.error('âŒ ModalManager not available for emergency fallback');
                    }
                } catch (fallbackError) {
                    console.error('âŒ Emergency fallback also failed:', fallbackError);
                }
            }
        }

        function submitTerms() {
            try {
                console.log('ðŸ” Debug: submitTerms called');
                console.log('ðŸ” Debug: PROVIDER_CONFIG available:', !!window.PROVIDER_CONFIG);
                console.log('ðŸ” Debug: PROVIDER_CONFIG keys:', Object.keys(window.PROVIDER_CONFIG || {}));
                
                const checkbox = document.getElementById('termsCheckbox');
                if (!checkbox) {
                    console.error('âŒ Terms checkbox not found!');
                    alert('Terms checkbox not found. Please refresh the page.');
                    return;
                }
                
                console.log('âœ… Terms checkbox found, checked:', checkbox.checked);
                
                if (checkbox.checked) {
                    // Get the current selected provider from the dropdown
                    const providerSelect = document.getElementById('providerSelect');
                    if (!providerSelect) {
                        console.error('âŒ Provider select not found!');
                        alert('Provider selection not found. Please refresh the page.');
                        return;
                    }
                    
                    const selectedProviderValue = providerSelect.value;
                    console.log('âœ… Selected provider value:', selectedProviderValue);
                    console.log('ðŸ” Debug: selectedProviderValue type:', typeof selectedProviderValue);
                    console.log('ðŸ” Debug: selectedProviderValue value:', selectedProviderValue);
                    
                    // Validate that a provider is actually selected
                    if (!selectedProviderValue || selectedProviderValue === '') {
                        console.error('âŒ No provider selected!');
                        alert('Please select a provider before continuing.');
                        return;
                    }
                    
                    // Store selected provider for use in subsequent steps
                    window.selectedProviderForWorkflow = selectedProviderValue;
                    console.log('âœ… Stored selectedProviderForWorkflow:', window.selectedProviderForWorkflow);
                    
                    // Validate that we have the provider config using safety function
                    console.log('ðŸ” Debug: About to check provider config for:', selectedProviderValue);
                    const providerConfig = getProviderConfig(selectedProviderValue);
                    
                    if (!providerConfig) {
                        console.error('âŒ Provider config validation failed');
                        alert('Provider configuration not available. Please refresh the page.');
                        return;
                    }
                    
                    console.log('âœ… Provider config found:', providerConfig.name);
                    
                    // Close terms modal and show authentication modal
                    console.log('âœ… Closing terms modal and showing auth modal');
                    modalManager.hide('termsModal');
                    
                    // Reset authentication form before showing
                    resetAuthenticationForm();
                    
                    modalManager.show('authModal');
                    
                    console.log('âœ… Modal transition should be complete');
                    
                } else {
                    console.log('âš ï¸ Checkbox not checked, showing alert');
                    alert('Please accept the terms and conditions to continue.');
                }
                
            } catch (error) {
                console.error('âŒ Error in submitTerms:', error);
                console.error('âŒ Error details:', error.stack);
                console.error('âŒ Error location:', error.fileName, 'line:', error.lineNumber);
                alert('An error occurred while processing your submission. Check the console for details.');
            }
        }

        function handleAuthSubmit(event) {
            event.preventDefault();
            
            console.log('ðŸ” Debug: handleAuthSubmit called');
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            console.log('ðŸ” Debug: Username:', username, 'Password length:', password.length);
            
            if (!username || !password) {
                alert('Please enter both username and password.');
                return;
            }
            
            console.log('ðŸ” Mock OAuth: Starting FHIR OAuth flow simulation');
            console.log('ðŸ” Mock OAuth: Username:', username, 'Provider:', window.selectedProviderForWorkflow);
            
            // Validate workflow state before proceeding
            if (!window.selectedProviderForWorkflow) {
                console.error('âŒ No provider selected for workflow in handleAuthSubmit');
                alert('No provider selected. Please start the workflow again.');
                return;
            }
            
            console.log('âœ… Workflow state validated, proceeding with OAuth simulation');
            
            // Close auth modal and show progress modal
            modalManager.hide('authModal');
            modalManager.show('progressModal');
            
            console.log('âœ… Progress modal shown, calling simulateFHIRConnection');
            
            // Simulate FHIR OAuth authentication and connection process
            simulateFHIRConnection();
        }

        async function simulateFHIRConnection() {
            try {
                console.log('ðŸ” Debug: simulateFHIRConnection called');
                
                // Validate that we have a provider selected before starting
                if (!window.selectedProviderForWorkflow) {
                    console.error('âŒ No provider selected for workflow');
                    alert('No provider selected. Please start the workflow again.');
                    return;
                }
                
                console.log('âœ… Provider validation passed:', window.selectedProviderForWorkflow);
                
                // Reset OAuth steps to ensure clean start
                resetOAuthSteps();
                console.log('âœ… OAuth steps reset');
                
                console.log('ðŸ” Mock OAuth: Starting FHIR OAuth flow simulation for provider:', window.selectedProviderForWorkflow);
                
                // Step 1: Simulate OAuth authorization request
                console.log('ðŸ” Mock OAuth: Step 1 - Authorization Request');
                console.log('   - Redirecting to provider OAuth endpoint');
                console.log('   - Requesting scopes: openid, fhirUser, launch/patient');
                console.log('   - Using PKCE flow for security');
                
                // Update visual progress
                updateOAuthStep(1, 'âœ… Authorization Request Complete');
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Step 2: Simulate user consent and redirect
                console.log('ðŸ” Mock OAuth: Step 2 - User Consent & Redirect');
                console.log('   - User authorized access to FHIR resources');
                console.log('   - Provider redirecting with authorization code');
                console.log('   - State parameter validated for CSRF protection');
                
                // Update visual progress
                updateOAuthStep(2, 'âœ… User Consent & Redirect Complete');
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Step 3: Simulate token exchange
                console.log('ðŸ” Mock OAuth: Step 3 - Token Exchange');
                console.log('   - Exchanging authorization code for access token');
                console.log('   - Validating JWT token signature');
                console.log('   - Extracting patient context from token');
                console.log('   - Setting up SMART launch context');
                
                // Update visual progress
                updateOAuthStep(3, 'âœ… Token Exchange Complete');
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Step 4: Simulate FHIR resource access
                console.log('ðŸ” Mock OAuth: Step 4 - FHIR Resource Access');
                console.log('   - Accessing Patient resource with token');
                console.log('   - Retrieving ExplanationOfBenefit resources');
                console.log('   - Parsing FHIR JSON responses');
                console.log('   - Mapping to internal claim format');
                
                // Update visual progress
                updateOAuthStep(4, 'âœ… FHIR Resource Access Complete');
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                console.log('ðŸ” Mock OAuth: FHIR OAuth flow simulation complete');
                
                // Close progress modal and show success modal
                modalManager.hide('progressModal');
                modalManager.show('successModal');
                
                // Simulate additional delay before auto-closing (3 seconds as requested)
                setTimeout(() => {
                    console.log('ðŸ” Mock OAuth: Auto-closing success modal after 3 seconds');
                    modalManager.hide('successModal');
                    
                    // Get provider info for success message and transactions
                    const selectedProvider = window.selectedProviderForWorkflow;
                    if (!selectedProvider) {
                        console.error('âŒ No provider selected for workflow, cannot create transactions');
                        return;
                    }
                    
                    const providerConfig = getProviderConfig(selectedProvider);
                    if (!providerConfig) {
                        console.error('âŒ Provider config not found for:', selectedProvider);
                        return;
                    }
                    
                    const providerName = providerConfig.name;
                    console.log('âœ… Using provider for success message and transactions:', providerName);
                    
                    // Show success message in main interface
                    const successMessage = document.getElementById('successMessage');
                    const providerNameElement = document.getElementById('providerName');
                    
                    if (successMessage) {
                        successMessage.classList.remove('hidden');
                    }
                    
                    if (providerNameElement) {
                        providerNameElement.textContent = providerName;
                        console.log('âœ… Provider name updated in success banner:', providerName);
                    }
                    
                    // Hide pre-authentication message
                    const preAuthMessage = document.getElementById('preAuthMessage');
                    if (preAuthMessage) {
                        preAuthMessage.style.display = 'none';
                    }
                    
                    // Show provider claims section
                    const providerClaimsSection = document.getElementById('providerClaimsSection');
                    if (providerClaimsSection) {
                        providerClaimsSection.classList.remove('hidden');
                    }
                    
                    // Show Get Started section
                    const getStartedSection = document.getElementById('getStartedSection');
                    if (getStartedSection) {
                        getStartedSection.classList.remove('hidden');
                    }
                    
                    // Create mock transaction using safety function
                    const baseTransaction = getDefaultTransaction();
                    const mockTransaction = {
                        ...baseTransaction,
                        provider: providerName,
                        source: 'FHIR OAuth Integration',
                        status: 'Approved',
                        patientResponsibility: 25.0
                    };
                    
                    addTransaction(mockTransaction);
                    
                    // Add additional mock transactions for demo
                    const additionalTransactions = [
                        {
                            id: 'TX-002',
                            provider: providerName,
                            dateOfService: '2025-08-18',
                            patientResponsibility: 15.0,
                            status: 'Approved',
                            source: 'FHIR OAuth Integration'
                        },
                        {
                            id: 'TX-003',
                            provider: providerName,
                            dateOfService: '2025-08-17',
                            patientResponsibility: 45.0,
                            status: 'Approved',
                            source: 'FHIR OAuth Integration'
                        }
                    ];
                    
                    additionalTransactions.forEach(tx => addTransaction(tx));
                    
                    // Add provider to connected providers list
                    if (!connectedProviders.includes(selectedProvider)) {
                        connectedProviders.push(selectedProvider);
                        console.log('âœ… Provider added to connected provider list:', selectedProvider);
                        console.log('ðŸ”— Connected providers:', connectedProviders);
                        
                        // Update the Add Another Provider button state
                        updateAddAnotherProviderButton();
                    }
                    
                    console.log('âœ… FHIR OAuth simulation complete - Claims populated');
                    console.log('ðŸ” Mock OAuth: User returned to home screen with populated claims');
                    
                }, 3000);
                
            } catch (error) {
                console.error('âŒ Error in FHIR OAuth simulation:', error);
                alert('An error occurred during the FHIR OAuth process. Please try again.');
            }
        }

        function completeConnection() {
            try {
                // Use the selected provider from the workflow
                const selectedProvider = window.selectedProviderForWorkflow;
                if (!selectedProvider) {
                    console.error('âŒ No provider selected for workflow');
                    alert('No provider selected. Please start the workflow again.');
                    return;
                }
                
                const providerConfig = getProviderConfig(selectedProvider);
                if (!providerConfig) {
                    console.error('âŒ Provider config not found for:', selectedProvider);
                    alert('Provider configuration not available. Please try again.');
                    return;
                }
                
                // Close success modal
                modalManager.hide('successModal');
                
                // Hide pre-authentication message and show provider claims section
                const preAuthMessage = document.getElementById('preAuthMessage');
                const providerClaimsSection = document.getElementById('providerClaimsSection');
                
                if (preAuthMessage) {
                    preAuthMessage.style.display = 'none';
                }
                
                if (providerClaimsSection) {
                    providerClaimsSection.classList.remove('hidden');
                }
                
                // Show Get Started section
                const getStartedSection = document.getElementById('getStartedSection');
                if (getStartedSection) {
                    getStartedSection.classList.remove('hidden');
                }
                
                                    // Add pending transaction to consolidated table
                    const defaultTransaction = getDefaultTransaction();
                    addTransaction(defaultTransaction);
                
                // Show success message in main interface
                const successMessage = document.getElementById('successMessage');
                const providerNameElement = document.getElementById('providerName');
                
                if (successMessage) {
                    successMessage.classList.remove('hidden');
                }
                
                if (providerNameElement) {
                    providerNameElement.textContent = providerConfig.name;
                }
                
                // Add provider to connected providers list
                if (!connectedProviders.includes(selectedProvider)) {
                    connectedProviders.push(selectedProvider);
                    console.log('âœ… Provider added to connected providers list:', selectedProvider);
                    console.log('ðŸ”— Connected providers:', connectedProviders);
                    
                    // Update the Add Another Provider button state
                    updateAddAnotherProviderButton();
                }
                
                console.log('âœ… Connection completed successfully for provider:', providerConfig.name);
                
            } catch (error) {
                console.error('âŒ Error in completeConnection:', error);
                alert('An error occurred while completing the connection. Please try again.');
            }
        }

        function showTerms() {
            try {
                const providerSelect = document.getElementById('providerSelect');
                if (!providerSelect || !providerSelect.value || providerSelect.value === '') {
                    alert('Please select a provider first to view their terms and conditions.');
                    return;
                }
                
                const providerConfig = getProviderConfig(providerSelect.value);
                if (providerConfig) {
                    alert(providerConfig.terms);
                } else {
                    alert('Provider terms not available. Please select a provider first.');
                }
            } catch (error) {
                console.warn('âš ï¸ Could not show terms:', error.message);
                alert('Terms not available. Please try again.');
            }
        }

        function updateTermsDisplay() {
            try {
                // Get the current selected provider from the dropdown
                const providerSelect = document.getElementById('providerSelect');
                const termsSection = document.getElementById('termsSection');
                const termsLink = document.getElementById('termsLink');
                
                if (!providerSelect || !termsSection || !termsLink) {
                    console.warn('âš ï¸ Required elements not found for terms display');
                    return;
                }
                
                const selectedProviderValue = providerSelect.value;
                
                // Only show terms section if a provider is selected
                if (selectedProviderValue && selectedProviderValue !== '') {
                    // Validate that we have the provider config
                    const providerConfig = getProviderConfig(selectedProviderValue);
                    
                    if (providerConfig) {
                        // Show terms section and populate with provider-specific terms
                        termsSection.style.display = 'block';
                        termsLink.textContent = `${providerConfig.name} Terms and Conditions`;
                        
                        // Update provider display throughout the workflow
                        updateProviderDisplay(selectedProviderValue);
                        
                        console.log('âœ… Terms display updated for provider:', providerConfig.name);
                    } else {
                        // Hide terms section if provider config not found
                        termsSection.style.display = 'none';
                        console.log('â„¹ï¸ No provider selected, terms section hidden');
                    }
                } else {
                    // Hide terms section if no provider selected
                    termsSection.style.display = 'none';
                    console.log('â„¹ï¸ No provider selected, terms section hidden');
                }
                
            } catch (error) {
                console.warn('âš ï¸ Could not update terms display:', error.message);
            }
        }

        function updateProviderDisplay(providerKey = null) {
            try {
                // Use provided provider key or fallback to current selection
                let currentProvider = providerKey || window.selectedProviderForWorkflow;
                
                // If no provider is selected, don't update anything
                if (!currentProvider) {
                    console.log('â„¹ï¸ No provider selected, skipping provider display update');
                    return;
                }
                
                const provider = getProviderConfig(currentProvider);
                if (!provider) {
                    console.warn('âš ï¸ Provider config not found for:', currentProvider);
                    return;
                }
                
                // dev: updating provider display
            
                // Update authentication modal
                const providerLogo = document.getElementById('providerLogo');
                const providerDisplayName = document.getElementById('providerDisplayName');
                
                if (providerLogo) {
                    providerLogo.src = provider.logo;
                    providerLogo.alt = `${provider.name} Logo`;
                    // dev: updated provider logo
                }
                
                if (providerDisplayName) {
                    providerDisplayName.textContent = provider.displayName;
                    // dev: updated provider display name
                }
                
                // Update success modal content
                const connectedProviderName = document.getElementById('connectedProviderName');
                if (connectedProviderName) {
                    connectedProviderName.textContent = provider.name;
                    // dev: updated success modal provider name
                }
            } catch (error) {
                console.warn('âš ï¸ Could not update provider display:', error.message);
            }
        }

        // Safety check for provider config
        function getProviderConfig(providerKey) {
            if (!window.PROVIDER_CONFIG) {
                console.error('âŒ PROVIDER_CONFIG not available');
                return null;
            }
            
            if (!providerKey) {
                console.error('âŒ No provider key provided');
                return null;
            }
            
            const config = window.PROVIDER_CONFIG[providerKey];
            if (!config) {
                console.error('âŒ Provider config not found for:', providerKey);
                return null;
            }
            
            return config;
        }
        
        // Safety check for app config
        function getAppConfig() {
            if (!window.APP_CONFIG) {
                console.error('âŒ APP_CONFIG not available');
                return null;
            }
            
            return window.APP_CONFIG;
        }
        
        // Safety check for default transaction
        function getDefaultTransaction() {
            const appConfig = getAppConfig();
            if (!appConfig || !appConfig.DEFAULT_TRANSACTION) {
                console.warn('âš ï¸ DEFAULT_TRANSACTION not available, creating fallback');
                return {
                    id: 'TX-FALLBACK',
                    provider: 'Provider Service',
                    dateOfService: new Date().toISOString().split('T')[0],
                    patientResponsibility: 0.0,
                    currency: 'USD',
                    status: 'Connected',
                    source: 'Provider Integration',
                };
            }
            
            return appConfig.DEFAULT_TRANSACTION;
        }

        // Update OAuth progress step visualization
        function updateOAuthStep(stepNumber, status) {
            const oauthSteps = document.getElementById('oauthSteps');
            if (oauthSteps && oauthSteps.children[stepNumber - 1]) {
                const stepElement = oauthSteps.children[stepNumber - 1];
                
                // Remove existing classes
                stepElement.classList.remove('active', 'completed');
                
                if (status === 'completed') {
                    stepElement.classList.add('completed');
                    stepElement.innerHTML = `<span style="color: #059669; font-weight: 600;">âœ… ${status}</span>`;
                    stepElement.style.background = 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)';
                    stepElement.style.border = '1px solid #10b981';
                } else if (status === 'active') {
                    stepElement.classList.add('active');
                    stepElement.innerHTML = `<span style="color: #1e40af; font-weight: 600;">â³ ${status}</span>`;
                    stepElement.style.background = 'linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%)';
                    stepElement.style.border = '1px solid #3b82f6';
                } else {
                    stepElement.innerHTML = `<span style="color: #6b7280;">â³ ${status}</span>`;
                    stepElement.style.background = 'linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)';
                    stepElement.style.border = '1px solid rgba(209, 213, 219, 0.5)';
                }
                
                // Add smooth transition
                stepElement.style.transition = 'all 0.5s ease';
            }
        }
        
        // Function to reset OAuth steps to initial state
        function resetOAuthSteps() {
            const oauthSteps = document.getElementById('oauthSteps');
            if (oauthSteps) {
                const steps = oauthSteps.querySelectorAll('.oauth-step');
                steps.forEach((step, index) => {
                    step.innerHTML = `<span style="color: #6b7280;">â³ Step ${index + 1}: ${getOAuthStepDescription(index + 1)}</span>`;
                    step.style.background = 'linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)';
                    step.style.border = '1px solid rgba(209, 213, 219, 0.5)';
                    step.classList.remove('active', 'completed');
                });
                console.log('âœ… OAuth steps reset to initial state');
            }
        }
        
        // Function to reset authentication form
        function resetAuthenticationForm() {
            try {
                console.log('ðŸ§¹ Resetting authentication form...');
                
                // Reset username and password inputs
                const usernameInput = document.getElementById('username');
                const passwordInput = document.getElementById('password');
                const authForm = document.getElementById('authForm');
                
                if (usernameInput) {
                    usernameInput.value = '';
                    usernameInput.classList.remove('error', 'loading');
                }
                
                if (passwordInput) {
                    passwordInput.value = '';
                    passwordInput.classList.remove('error', 'loading');
                }
                
                if (authForm) {
                    // Reset submit button to initial state
                    const submitButton = authForm.querySelector('button[type="submit"]');
                    if (submitButton) {
                        submitButton.textContent = 'Sign In';
                        submitButton.classList.remove('loading');
                    }
                }
                
                console.log('âœ… Authentication form reset successfully');
                
            } catch (error) {
                console.error('âŒ Error resetting authentication form:', error);
            }
        }

        // Enhanced error handling with user-friendly messages
        function showUserFriendlyError(error, context = '') {
            console.error(`âŒ Error in ${context}:`, error);
            
            let userMessage = 'An unexpected error occurred. Please try again.';
            
            if (error.message) {
                if (error.message.includes('network') || error.message.includes('fetch')) {
                    userMessage = 'Network connection issue. Please check your internet connection and try again.';
                } else if (error.message.includes('timeout')) {
                    userMessage = 'Request timed out. Please try again.';
                } else if (error.message.includes('provider')) {
                    userMessage = 'Provider configuration issue. Please refresh the page and try again.';
                }
            }
            
            // Show error message in a user-friendly way
            showNotification(userMessage, 'error');
        }

        // Enhanced notification system
        function showNotification(message, type = 'info', duration = 5000) {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification-toast');
            existingNotifications.forEach(notification => notification.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification-toast notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${getNotificationIcon(type)}</span>
                    <span class="notification-message">${message}</span>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
                </div>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Auto-remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, duration);
            }
        }

        // Get notification icon based on type
        function getNotificationIcon(type) {
            switch (type) {
                case 'success': return 'âœ…';
                case 'error': return 'âŒ';
                case 'warning': return 'âš ï¸';
                case 'info': return 'â„¹ï¸';
                default: return 'â„¹ï¸';
            }
        }

        // Enhanced form validation
        function validateForm(formElement) {
            const inputs = formElement.querySelectorAll('input[required], select[required]');
            let isValid = true;
            let firstInvalidInput = null;
            
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('error');
                    
                    if (!firstInvalidInput) {
                        firstInvalidInput = input;
                    }
                } else {
                    input.classList.remove('error');
                }
            });
            
            if (!isValid && firstInvalidInput) {
                firstInvalidInput.focus();
                showNotification('Please fill in all required fields.', 'warning');
            }
            
            return isValid;
        }

        // Enhanced loading states
        function setLoadingState(element, isLoading) {
            if (isLoading) {
                element.classList.add('loading');
                element.disabled = true;
                element.dataset.originalText = element.textContent;
                element.textContent = 'Loading...';
            } else {
                element.classList.remove('loading');
                element.disabled = false;
                if (element.dataset.originalText) {
                    element.textContent = element.dataset.originalText;
                }
            }
        }

        // Enhanced modal transitions - Now handled by ModalManager
        // These functions are deprecated and replaced by ModalManager.show() and ModalManager.hide()

        // Enhanced accessibility
        function enhanceAccessibility() {
            // Add ARIA labels to interactive elements
            const actionButtons = document.querySelectorAll('.action-btn, .btn-primary, .btn-secondary');
            actionButtons.forEach(button => {
                if (!button.getAttribute('aria-label')) {
                    button.setAttribute('aria-label', button.textContent.trim());
                }
            });
            
            // Add keyboard navigation to modals
            const modals = document.querySelectorAll('.workflow-modal');
            modals.forEach(modal => {
                modal.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        const closeButton = modal.querySelector('.modal-close');
                        if (closeButton) {
                            closeButton.click();
                        }
                    }
                });
            });
        }

        // Enhanced performance monitoring
        function monitorPerformance() {
            if ('performance' in window) {
                window.addEventListener('load', () => {
                    const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                    console.log(`ðŸš€ Page loaded in ${loadTime}ms`);
                    
                    if (loadTime > 3000) {
                        console.warn('âš ï¸ Page load time is slow. Consider optimizing assets.');
                    }
                });
            }
        }

        // Enhanced error boundary
        function setupErrorBoundary() {
            window.addEventListener('error', (event) => {
                console.error('âŒ Global error caught:', event.error);
                showUserFriendlyError(event.error, 'global');
            });
            
            window.addEventListener('unhandledrejection', (event) => {
                console.error('âŒ Unhandled promise rejection:', event.reason);
                showUserFriendlyError(event.reason, 'promise');
            });
        }

        // Initialize enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Enhance accessibility
                enhanceAccessibility();
                
                // Setup error boundary
                setupErrorBoundary();
                
                // Monitor performance
                monitorPerformance();
                
                // Add smooth scrolling to all internal links
                const internalLinks = document.querySelectorAll('a[href^="#"]');
                internalLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('href').substring(1);
                        const targetElement = document.getElementById(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                        }
                    });
                });
                
                // Initialize pre-auth section enhancements
                initializePreAuthSection();
                
                console.log('âœ… Enhanced features initialized successfully');
                
            } catch (error) {
                console.error('âŒ Error initializing enhanced features:', error);
            }
        });

        // Centralized Component Factory
        const ComponentFactory = {
            // Create button elements with consistent structure
            createButton: (options = {}) => {
                const {
                    text = 'Button',
                    icon = '',
                    arrow = false,
                    className = 'action-btn',
                    variant = 'primary',
                    onClick = null
                } = options;

                const button = document.createElement('button');
                button.className = `${className} ${variant}`;
                button.innerHTML = `
                    ${icon ? `<span class="btn-icon">${icon}</span>` : ''}
                    <span class="btn-text">${text}</span>
                    ${arrow ? '<span class="btn-arrow">â†’</span>' : ''}
                `;
                
                if (onClick) {
                    button.addEventListener('click', onClick);
                }
                
                return button;
            },

            // Create benefit item with consistent structure
            createBenefitItem: (icon, text) => {
                const item = document.createElement('div');
                item.className = 'benefit-item hover-lift';
                item.innerHTML = `
                    <span class="benefit-icon">${icon}</span>
                    <span>${text}</span>
                `;
                return item;
            },

            // Create notification element
            createNotification: (message, type = 'info', duration = 5000) => {
                const notification = document.createElement('div');
                notification.className = `notification-toast notification-${type}`;
                notification.innerHTML = `
                    <div class="notification-content">
                        <span class="notification-icon">${UIUtils.getNotificationIcon(type)}</span>
                        <span class="notification-message">${message}</span>
                        <button class="notification-close" onclick="this.parentElement.parentElement.remove()">Ã—</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => notification.classList.add('show'), 100);
                
                // Auto-remove after duration
                if (duration > 0) {
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }, duration);
                }
                
                return notification;
            }
        };

        // Centralized Utility System
        const UIUtils = {
            // Notification utilities
            getNotificationIcon: (type) => {
                switch (type) {
                    case 'success': return 'âœ…';
                    case 'error': return 'âŒ';
                    case 'warning': return 'âš ï¸';
                    case 'info': return 'â„¹ï¸';
                    default: return 'â„¹ï¸';
                }
            },

            // Animation utilities
            animations: {
                // Add scroll-triggered animations to elements
                addScrollAnimations: (container, selectors, options = {}) => {
                    const defaultOptions = {
                        threshold: 0.1,
                        delay: 0.1,
                        duration: 0.6,
                        transform: 'translateY(20px)'
                    };
                    const config = { ...defaultOptions, ...options };
                    
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.style.opacity = '1';
                                entry.target.style.transform = 'translateY(0)';
                            }
                        });
                    }, { threshold: config.threshold });

                    const elements = container.querySelectorAll(selectors);
                    elements.forEach((element, index) => {
                        element.style.opacity = '0';
                        element.style.transform = config.transform;
                        element.style.transition = `opacity ${config.duration}s ease ${index * config.delay}s, transform ${config.duration}s ease ${index * config.delay}s`;
                        observer.observe(element);
                    });
                },

                // Add hover pause/resume for animated elements
                addHoverPause: (elements, animationProperty = 'animation') => {
                    elements.forEach(element => {
                        element.addEventListener('mouseenter', () => {
                            element.style[animationProperty + 'PlayState'] = 'paused';
                        });
                        
                        element.addEventListener('mouseleave', () => {
                            element.style[animationProperty + 'PlayState'] = 'running';
                        });
                    });
                }
            },

            // Button utilities
            buttons: {
                // Add loading state to button
                setLoadingState: (button, loadingText = 'Loading...', icon = 'â³') => {
                    const originalHTML = button.innerHTML;
                    button.innerHTML = `<span class="btn-icon">${icon}</span><span class="btn-text">${loadingText}</span>`;
                    button.disabled = true;
                    button.style.cursor = 'not-allowed';
                    
                    return () => {
                        button.innerHTML = originalHTML;
                        button.disabled = false;
                        button.style.cursor = 'pointer';
                    };
                },

                // Add click tracking
                addClickTracking: (button, eventName, callback) => {
                    button.addEventListener('click', () => {
                        console.log(`ðŸŽ¯ ${eventName} button clicked - tracking engagement`);
                        if (callback) callback();
                    });
                }
            },

            // DOM utilities
            dom: {
                // Safe element selection with error handling
                safeQuerySelector: (selector, parent = document) => {
                    try {
                        const element = parent.querySelector(selector);
                        if (!element) {
                            console.warn(`âš ï¸ Element not found: ${selector}`);
                        }
                        return element;
                    } catch (error) {
                        console.error(`âŒ Error selecting element ${selector}:`, error);
                        return null;
                    }
                },

                // Safe element selection for multiple elements
                safeQuerySelectorAll: (selector, parent = document) => {
                    try {
                        const elements = parent.querySelectorAll(selector);
                        if (elements.length === 0) {
                            console.warn(`âš ï¸ No elements found: ${selector}`);
                        }
                        return elements;
                    } catch (error) {
                        console.error(`âŒ Error selecting elements ${selector}:`, error);
                        return [];
                    }
                }
            }
        };

        // Enhanced Pre-Authentication Section
        function initializePreAuthSection() {
            try {
                const preAuthSection = UIUtils.dom.safeQuerySelector('.pre-auth-message');
                if (!preAuthSection) return;

                // Add scroll animations
                UIUtils.animations.addScrollAnimations(preAuthSection, 
                    '.pre-auth-icon, h3, p, .pre-auth-benefits, .pre-auth-action',
                    { delay: 0.15, duration: 0.8 }
                );

                // Add hover effects to benefit items
                const benefitItems = UIUtils.dom.safeQuerySelectorAll('.benefit-item', preAuthSection);
                UIUtils.animations.addHoverPause(benefitItems);

                // Add click tracking to CTA button
                const ctaButton = UIUtils.dom.safeQuerySelector('.pre-auth-cta-button', preAuthSection);
                if (ctaButton) {
                    UIUtils.buttons.addClickTracking(ctaButton, 'Pre-Auth CTA', () => {
                        // Add loading state
                        const restoreButton = UIUtils.buttons.setLoadingState(ctaButton, 'Connecting...', 'â³');
                        
                        // Restore button after delay (simulating modal opening)
                        setTimeout(restoreButton, 1000);
                    });
                }

                console.log('âœ… Pre-auth section enhancements initialized');
                
            } catch (error) {
                console.error('âŒ Error initializing pre-auth section:', error);
            }
        }

        // Enhanced provider selection with visual feedback
        function enhanceProviderSelection() {
            const providerSelect = document.getElementById('providerSelect');
            if (providerSelect) {
                providerSelect.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption.value) {
                        // Add visual feedback
                        this.style.borderColor = '#10b981';
                        this.style.boxShadow = '0 0 0 3px rgba(16, 185, 129, 0.1)';
                        
                        // Update terms display and enable submit button
                        updateTermsDisplay();
                        updateSubmitButtonState();
                        
                        // Remove feedback after animation
                        setTimeout(() => {
                            this.style.borderColor = '';
                            this.style.boxShadow = '';
                        }, 1000);
                    } else {
                        // Hide terms section and disable submit button if no provider selected
                        const termsSection = document.getElementById('termsSection');
                        if (termsSection) {
                            termsSection.style.display = 'none';
                        }
                        updateSubmitButtonState();
                    }
                });
            }
        }

        // Function to update submit button state based on form completion
        function updateSubmitButtonState() {
            const providerSelect = document.getElementById('providerSelect');
            const termsCheckbox = document.getElementById('termsCheckbox');
            const submitBtn = document.getElementById('submitTermsBtn');
            
            if (providerSelect && termsCheckbox && submitBtn) {
                const hasProvider = providerSelect.value && providerSelect.value !== '';
                const hasAcceptedTerms = termsCheckbox.checked;
                
                // Enable submit button only if provider is selected AND terms are accepted
                submitBtn.disabled = !(hasProvider && hasAcceptedTerms);
                
                console.log('ðŸ” Submit button state updated:', {
                    hasProvider,
                    hasAcceptedTerms,
                    buttonEnabled: !submitBtn.disabled
                });
            }
        }

        // Enhanced form submission with better UX
        function enhanceFormSubmission() {
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                // Skip the authentication form - it has its own handler
                if (form.id === 'authForm') {
                    console.log('â„¹ï¸ Skipping generic form handler for authForm');
                    return;
                }
                
                form.addEventListener('submit', function(e) {
                    if (!validateForm(this)) {
                        e.preventDefault();
                        return false;
                    }
                    
                    // Show loading state
                    const submitButton = this.querySelector('button[type="submit"]');
                    if (submitButton) {
                        setLoadingState(submitButton, true);
                    }
                });
            });
            
            // Add event listener for terms checkbox
            const termsCheckbox = document.getElementById('termsCheckbox');
            if (termsCheckbox) {
                termsCheckbox.addEventListener('change', function() {
                    updateSubmitButtonState();
                    console.log('ðŸ” Terms checkbox changed:', this.checked);
                });
            }
        }

        // Initialize enhanced form features
        document.addEventListener('DOMContentLoaded', function() {
            enhanceProviderSelection();
            enhanceFormSubmission();
            
            // Initialize form state
            updateSubmitButtonState();
            
            // Initialize Add Another Provider button state
            updateAddAnotherProviderButton();
        });

        // ========================================
        // DEVELOPMENT HELPER FUNCTIONS
        // ========================================
        // These functions help debug and maintain the portal
        // Access them from browser console: window.devHelpers.functionName()
        // 
        // Available functions:
        // - checkModals(): Show modal status
        // - resetModals(): Force hide all modals
        // - testModal(id): Show specific modal for testing
        // - checkMainContent(): Check main content visibility
        // - checkPortalElements(): Check portal element visibility
        // - resetPortal(): Emergency reset if things go wrong
        // ========================================
        
        // Development Helper Functions - Use these for future UX enhancements
        window.devHelpers = {
            // Check modal status
            checkModals: () => modalManager.debug(),
            
            // Force hide all modals (emergency reset)
            resetModals: () => modalManager.hideAll(),
            
            // Show specific modal for testing
            testModal: (modalId) => modalManager.show(modalId),
            
            // Check main content visibility
            checkMainContent: () => {
                const main = document.querySelector('.main-content');
                if (main) {
                    const style = window.getComputedStyle(main);
                    return {
                        display: style.display,
                        visibility: style.visibility,
                        opacity: style.opacity,
                        zIndex: style.zIndex
                    };
                }
                return null;
            },
            
            // Check portal elements visibility
            checkPortalElements: () => {
                const elements = [
                    '.action-buttons-section',
                    '.provider-claims-section', 
                    '.tasks-section',
                    '.hsa-planner-section',
                    '.action-buttons',
                    '.action-btn'
                ];
                
                const results = elements.map(selector => {
                    const element = document.querySelector(selector);
                    if (element) {
                        const style = window.getComputedStyle(element);
                        return {
                            selector,
                            display: style.display,
                            visibility: style.visibility,
                            opacity: style.opacity
                        };
                    }
                    return { selector, missing: true };
                });
                return results;
            },
            
            // Emergency portal reset
            resetPortal: () => {
                modalManager.hideAll();
                console.log('ðŸ”§ Portal reset complete - all modals hidden');
                // dev: portal reset complete
            },
            
            // Test function for Connect My Provider button
            testConnectProvider: () => {
                console.log('ðŸ§ª Testing Connect My Provider button...');
                console.log('ModalManager available:', !!window.modalManager);
                console.log('PROVIDER_CONFIG loaded:', !!window.PROVIDER_CONFIG);
                console.log('APP_CONFIG loaded:', !!window.APP_CONFIG);
                console.log('Terms modal exists:', !!document.getElementById('termsModal'));
                
                // Try to call the function
                try {
                    handleConnectProvider();
                    console.log('âœ… handleConnectProvider called successfully');
                } catch (error) {
                    console.error('âŒ Error calling handleConnectProvider:', error);
                }
            },
            
            // Test function for Submit button
            testSubmitTerms: () => {
                console.log('ðŸ§ª Testing Submit Terms functionality...');
                
                // Check if we're on the terms modal
                const termsModal = document.getElementById('termsModal');
                if (!termsModal || termsModal.classList.contains('hidden')) {
                    console.log('âš ï¸ Terms modal not visible, opening it first...');
                    handleConnectProvider();
                    setTimeout(() => testSubmitTerms(), 500);
                    return;
                }
                
                // Check checkbox state
                const checkbox = document.getElementById('termsCheckbox');
                if (checkbox) {
                    console.log('âœ… Checkbox found, current state:', checkbox.checked);
                    if (!checkbox.checked) {
                        console.log('ðŸ”§ Checking the checkbox...');
                        checkbox.checked = true;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                }
                
                // Check submit button state
                const submitBtn = document.getElementById('submitTermsBtn');
                if (submitBtn) {
                    console.log('âœ… Submit button found, disabled:', submitBtn.disabled);
                }
                
                // Try to submit
                console.log('ðŸš€ Attempting to submit...');
                submitTerms();
            },
            
            // FHIR OAuth Developer Documentation
            showFHIRDocs: () => {
                console.log('ðŸ“š === FHIR OAuth Implementation Guide ===');
                console.log('');
                console.log('ðŸ” OAuth 2.0 Flow for FHIR Integration:');
                console.log('   1. Authorization Request (PKCE)');
                console.log('   2. User Consent & Redirect');
                console.log('   3. Token Exchange');
                console.log('   4. FHIR Resource Access');
                console.log('');
                console.log('ðŸ¥ Required FHIR Scopes:');
                console.log('   - openid: OpenID Connect authentication');
                console.log('   - fhirUser: Access to user\'s FHIR resources');
                console.log('   - launch/patient: SMART launch context');
                console.log('   - patient/*.read: Read access to patient data');
                console.log('');
                console.log('ðŸ”’ Security Requirements:');
                console.log('   - PKCE (Proof Key for Code Exchange)');
                console.log('   - State parameter for CSRF protection');
                console.log('   - JWT token validation');
                console.log('   - HTTPS for all communications');
                console.log('');
                console.log('ðŸ“‹ Implementation Steps:');
                console.log('   1. Register app with FHIR provider');
                console.log('   2. Implement OAuth 2.0 authorization flow');
                console.log('   3. Handle token exchange and validation');
                console.log('   4. Make FHIR API calls with access token');
                console.log('   5. Parse FHIR responses and map to claims');
                console.log('');
                console.log('ðŸš€ Demo Mode: This simulation shows the complete flow');
                console.log('   without requiring actual FHIR provider integration.');
                console.log('');
            },
            
            // Test the complete FHIR OAuth flow
            testFHIRFlow: () => {
                console.log('ðŸ§ª Testing Complete FHIR OAuth Flow...');
                console.log('This will simulate the entire OAuth process');
                
                // Start the workflow
                handleConnectProvider();
                
                // Auto-advance through steps for demo
                setTimeout(() => {
                    const checkbox = document.getElementById('termsCheckbox');
                    if (checkbox) {
                        checkbox.checked = true;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                    
                    setTimeout(() => {
                        submitTerms();
                    }, 500);
                }, 1000);
            },
            
            // Force reload configurations
            forceReloadConfigs: () => {
                console.log('ðŸ”„ Force reloading configurations...');
                
                // Clear existing configs
                delete window.PROVIDER_CONFIG;
                delete window.APP_CONFIG;
                
                // Reload the config.js file
                const script = document.createElement('script');
                script.src = 'config.js?v=' + Date.now(); // Force cache bust
                script.onload = () => {
                    console.log('âœ… Configs reloaded successfully');
                    console.log('PROVIDER_CONFIG keys:', Object.keys(window.PROVIDER_CONFIG || {}));
                    console.log('APP_CONFIG:', window.APP_CONFIG);
                    
                    // Reinitialize the page
                    window.selectedProviderForWorkflow = (window.APP_CONFIG && window.APP_CONFIG.DEFAULT_PROVIDER) || 'trellis';
                    updateTermsDisplay();
                    setupWorkflowEventListeners();
                };
                script.onerror = () => {
                    console.error('âŒ Failed to reload configs');
                };
                document.head.appendChild(script);
            }
        };

        // Missing function that's referenced in HTML
        function closeAlert(button) {
            const alert = button.closest('.alert');
            if (alert) {
                alert.style.display = 'none';
            }
        }

        // Feature coming soon function
        function handleAuthFailure() {
            // Show error message in main interface
            const errorMessage = document.getElementById('errorMessage');
            if (errorMessage) {
                errorMessage.classList.remove('hidden');
            }
            
            // Hide success message if it was showing
            const successMessage = document.getElementById('successMessage');
            if (successMessage) {
                successMessage.classList.add('hidden');
            }
            
            // Keep provider claims section hidden since authentication failed
            const providerClaimsSection = document.getElementById('providerClaimsSection');
            if (providerClaimsSection) {
                providerClaimsSection.classList.add('hidden');
            }
            
            // Show pre-authentication message again
            const preAuthMessage = document.getElementById('preAuthMessage');
            if (preAuthMessage) {
                preAuthMessage.style.display = 'block';
            }
        }

        // Debug functions for troubleshooting
        window.debugModals = () => {
            console.log('ðŸ” Modal Debug Information:');
            console.log('ModalManager available:', !!window.modalManager);
            if (window.modalManager) {
                window.modalManager.debug();
            }
            
            // Check all modal elements
            const modals = document.querySelectorAll('.workflow-modal');
            console.log('Found workflow modals:', modals.length);
            modals.forEach(modal => {
                const isHidden = modal.classList.contains('hidden');
                const computedStyle = window.getComputedStyle(modal);
                console.log(`Modal ${modal.id}:`, {
                    hidden: isHidden,
                    display: computedStyle.display,
                    visibility: computedStyle.visibility,
                    opacity: computedStyle.opacity,
                    zIndex: computedStyle.zIndex
                });
            });
        };

        // Debug function specifically for the terms modal workflow
        window.debugTermsWorkflow = () => {
            console.log('ðŸ” Terms Workflow Debug:');
            
            const providerSelect = document.getElementById('providerSelect');
            const termsSection = document.getElementById('termsSection');
            const termsCheckbox = document.getElementById('termsCheckbox');
            const submitBtn = document.getElementById('submitTermsBtn');
            
            console.log('Provider Select:', {
                element: !!providerSelect,
                value: providerSelect?.value,
                options: providerSelect?.options?.length
            });
            
            console.log('Terms Section:', {
                element: !!termsSection,
                display: termsSection?.style.display,
                visible: termsSection?.style.display !== 'none'
            });
            
            console.log('Terms Checkbox:', {
                element: !!termsCheckbox,
                checked: termsCheckbox?.checked,
                required: termsCheckbox?.required
            });
            
            console.log('Submit Button:', {
                element: !!submitBtn,
                disabled: submitBtn?.disabled,
                text: submitBtn?.textContent
            });
            
            // Test the workflow
            console.log('ðŸ” Testing workflow logic...');
            updateTermsDisplay();
            updateSubmitButtonState();
        };

        // Debug function for connected providers
        window.debugConnectedProviders = () => {
            console.log('ðŸ” Connected Providers Debug:');
            console.log('  â€¢ Connected providers:', connectedProviders);
            console.log('  â€¢ Total available providers:', Object.keys(window.PROVIDER_CONFIG || {}).length);
            console.log('  â€¢ Available to connect:', Object.keys(window.PROVIDER_CONFIG || {}).filter(
                providerKey => !connectedProviders.includes(providerKey)
            ));
            
            // Also show in UI for easy debugging
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = 'position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; z-index: 10000;';
            statusDiv.innerHTML = `
                <strong>ðŸ” Debug Info:</strong><br>
                Connected: ${connectedProviders.join(', ') || 'None'}<br>
                Available: ${Object.keys(window.PROVIDER_CONFIG || {}).filter(p => !connectedProviders.includes(p)).join(', ') || 'None'}
            `;
            document.body.appendChild(statusDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.parentNode.removeChild(statusDiv);
                }
            }, 5000);
        };
        
        // Debug function for provider name elements
        window.debugProviderNameElements = () => {
            console.log('ðŸ” Provider Name Elements Debug:');
            
            const providerNameElement = document.getElementById('providerName');
            const successMessage = document.getElementById('successMessage');
            const connectedProviderName = document.getElementById('connectedProviderName');
            
            console.log('Provider Name Element:', {
                element: !!providerNameElement,
                textContent: providerNameElement?.textContent,
                innerHTML: providerNameElement?.innerHTML,
                visible: !successMessage?.classList?.contains('hidden')
            });
            
            console.log('Success Message:', {
                element: !!successMessage,
                hidden: successMessage?.classList?.contains('hidden'),
                display: successMessage?.style?.display
            });
            
            console.log('Connected Provider Name:', {
                element: !!connectedProviderName,
                textContent: connectedProviderName?.textContent
            });
            
            // Show current provider workflow state
            console.log('Current Workflow State:', {
                selectedProviderForWorkflow: window.selectedProviderForWorkflow,
                providerConfig: window.selectedProviderForWorkflow ? getProviderConfig(window.selectedProviderForWorkflow) : null
            });
        };
        
        // Debug function for Add Another Provider workflow
        window.debugAddAnotherProviderWorkflow = () => {
            console.log('ðŸ” Add Another Provider Workflow Debug:');
            
            const providerSelect = document.getElementById('providerSelect');
            const termsCheckbox = document.getElementById('termsCheckbox');
            const submitTermsBtn = document.getElementById('submitTermsBtn');
            const termsSection = document.getElementById('termsSection');
            
            console.log('Provider Select:', {
                element: !!providerSelect,
                value: providerSelect?.value,
                options: providerSelect ? Array.from(providerSelect.options).map(opt => ({ value: opt.value, text: opt.textContent })) : [],
                disabled: providerSelect?.disabled
            });
            
            console.log('Terms Checkbox:', {
                element: !!termsCheckbox,
                checked: termsCheckbox?.checked,
                disabled: termsCheckbox?.disabled
            });
            
            console.log('Submit Terms Button:', {
                element: !!submitTermsBtn,
                disabled: submitTermsBtn?.disabled,
                textContent: submitTermsBtn?.textContent
            });
            
            console.log('Terms Section:', {
                element: !!termsSection,
                display: termsSection?.style?.display,
                visible: termsSection?.style?.display !== 'none'
            });
            
            console.log('Workflow State:', {
                selectedProviderForWorkflow: window.selectedProviderForWorkflow,
                connectedProviders: connectedProviders,
                availableProviders: Object.keys(window.PROVIDER_CONFIG || {}).filter(p => !connectedProviders.includes(p))
            });
            
            console.log('Modal Manager:', {
                available: !!window.modalManager,
                currentModal: window.modalManager?.currentModal
            });
        };

        // Debug function for the transaction system
        window.debugTransactionSystem = () => {
            console.log('ðŸ” Transaction System Debug:');
            
            const claimsTableBody = document.getElementById('claimsTableBody');
            const providerClaimsSection = document.getElementById('providerClaimsSection');
            
            console.log('Claims Table Body:', {
                element: !!claimsTableBody,
                rowCount: claimsTableBody?.children?.length || 0
            });
            
            console.log('Provider Claims Section:', {
                element: !!providerClaimsSection,
                hidden: providerClaimsSection?.classList?.contains('hidden'),
                display: providerClaimsSection?.style?.display
            });
            
            // Test adding a sample transaction
            console.log('ðŸ§ª Testing transaction system...');
            const testTransaction = {
                id: 'TEST-001',
                provider: 'Test Provider',
                dateOfService: '2025-08-19',
                patientResponsibility: 50.00,
                status: 'Approved',
                source: 'Test System'
            };
            
            addTransaction(testTransaction);
            console.log('âœ… Test transaction added. Check the claims table!');
        };

        // Initialize enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Enhance accessibility
                enhanceAccessibility();
                
                // Setup error boundary
                setupErrorBoundary();
                
                // Monitor performance
                monitorPerformance();
                
                // Add smooth scrolling to all internal links
                const internalLinks = document.querySelectorAll('a[href^="#"]');
                internalLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('href').substring(1);
                        const targetElement = document.getElementById(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                        }
                    });
                });
                
                console.log('âœ… Enhanced features initialized successfully');
                
            } catch (error) {
                console.error('âŒ Error initializing enhanced features:', error);
            }
        });

        // Test functions for modal system
        window.testModalSystem = () => {
            console.log('ðŸ§ª Testing Modal System...');
            
            // Test 1: Check if ModalManager is available
            if (!window.modalManager) {
                console.error('âŒ ModalManager not available');
                return false;
            }
            console.log('âœ… ModalManager available');
            
            // Test 2: Check if modals exist
            const modals = document.querySelectorAll('.workflow-modal');
            if (modals.length === 0) {
                console.error('âŒ No workflow modals found');
                return false;
            }
            console.log(`âœ… Found ${modals.length} workflow modals`);
            
            // Test 3: Test showing a modal
            try {
                window.modalManager.show('termsModal');
                console.log('âœ… Modal show test passed');
                
                // Test 4: Test hiding a modal
                setTimeout(() => {
                    window.modalManager.hide('termsModal');
                    console.log('âœ… Modal hide test passed');
                    console.log('ðŸŽ‰ Modal system test complete!');
                }, 1000);
                
                return true;
            } catch (error) {
                console.error('âŒ Modal test failed:', error);
                return false;
            }
        };

        // Debug functions for troubleshooting

        // Function to add transactions to the claims table
        function addTransaction(transaction) {
            try {
                console.log('ðŸ” Adding transaction:', transaction);
                
                const claimsTableBody = document.getElementById('claimsTableBody');
                if (!claimsTableBody) {
                    console.error('âŒ Claims table body not found');
                    return;
                }
                
                // Create new table row
                const newRow = document.createElement('tr');
                
                // Format the date if it exists
                const formattedDate = transaction.dateOfService || transaction.date || 'N/A';
                
                // Format the amount with proper currency formatting
                const formattedAmount = transaction.patientResponsibility 
                    ? `$${parseFloat(transaction.patientResponsibility).toFixed(2)}`
                    : transaction.amount 
                        ? `$${parseFloat(transaction.amount).toFixed(2)}`
                        : 'N/A';
                
                // Create table cells
                newRow.innerHTML = `
                    <td>${transaction.provider || 'Unknown Provider'}</td>
                    <td>${formattedDate}</td>
                    <td>${formattedAmount}</td>
                    <td>
                        <span class="status-${transaction.status?.toLowerCase() || 'pending'}">
                            ${transaction.status || 'Pending'}
                        </span>
                    </td>
                    <td>
                        <button class="btn-secondary" onclick="showComingSoon('View Details')">
                            View
                        </button>
                    </td>
                `;
                
                // Add the new row to the table
                claimsTableBody.appendChild(newRow);
                
                console.log('âœ… Transaction added successfully:', transaction.id || 'Unknown ID');
                
                // Update the claims count if there's a notification badge
                updateClaimsCount();
                
            } catch (error) {
                console.error('âŒ Error adding transaction:', error);
            }
        }

        // Function to update the "Add Another Provider" button state
        function updateAddAnotherProviderButton() {
            try {
                const addAnotherProviderBtn = document.getElementById('addAnotherProviderBtn');
                if (!addAnotherProviderBtn) {
                    return;
                }
                
                // Check how many providers are available to connect
                const availableProviders = Object.keys(window.PROVIDER_CONFIG || {}).filter(
                    providerKey => !connectedProviders.includes(providerKey)
                );
                
                if (availableProviders.length === 0) {
                    // All providers connected
                    addAnotherProviderBtn.disabled = true;
                    addAnotherProviderBtn.textContent = 'âœ… All Providers Connected';
                    addAnotherProviderBtn.title = 'All available providers are already connected';
                } else if (availableProviders.length === 1) {
                    // One provider left
                    addAnotherProviderBtn.textContent = `âž• Add 1 More Provider`;
                    addAnotherProviderBtn.disabled = false;
                    addAnotherProviderBtn.title = `Connect ${availableProviders.length} remaining provider`;
                } else {
                    // Multiple providers left
                    addAnotherProviderBtn.textContent = `âž• Add Another Provider (${availableProviders.length} available)`;
                    addAnotherProviderBtn.disabled = false;
                    addAnotherProviderBtn.title = `Connect ${availableProviders.length} remaining providers`;
                }
                
                console.log('âœ… Add Another Provider button updated:', {
                    availableProviders,
                    connectedProviders,
                    buttonText: addAnotherProviderBtn.textContent
                });
                
            } catch (error) {
                console.warn('âš ï¸ Could not update Add Another Provider button:', error);
            }
        }

        // Function to update the claims count in the notification badge
        function updateClaimsCount() {
            try {
                const claimsTableBody = document.getElementById('claimsTableBody');
                const notificationBadge = document.querySelector('.tasks-section .notification-badge');
                
                if (claimsTableBody && notificationBadge) {
                    const claimCount = claimsTableBody.children.length;
                    notificationBadge.textContent = claimCount;
                    
                    // Update the task text based on count
                    const taskText = document.querySelector('.task-item .task-text');
                    if (taskText) {
                        if (claimCount === 0) {
                            taskText.textContent = 'No claims to review';
                        } else if (claimCount === 1) {
                            taskText.textContent = '1 claim needs review';
                        } else {
                            taskText.textContent = `${claimCount} claims need review`;
                        }
                    }
                }
            } catch (error) {
                console.warn('âš ï¸ Could not update claims count:', error);
            }
        }

        // Function to clear all transactions from the claims table
        function clearTransactions() {
            try {
                const claimsTableBody = document.getElementById('claimsTableBody');
                if (claimsTableBody) {
                    claimsTableBody.innerHTML = '';
                    updateClaimsCount();
                    console.log('âœ… All transactions cleared');
                }
            } catch (error) {
                console.error('âŒ Error clearing transactions:', error);
            }
        }

        // Enhanced provider selection with visual feedback
    </script>
</body>
</html>
